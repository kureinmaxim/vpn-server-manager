# üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ü–ê–†–ê–õ–õ–ï–õ–¨–ù–û–ì–û –ó–ê–ü–£–°–ö–ê

**–î–∞—Ç–∞:** 2025-10-12  
**–í–µ—Ä—Å–∏—è:** 4.0.0  
**–¶–µ–ª—å:** –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–π —Ä–∞–±–æ—Ç—ã –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

---

## ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

### 1. **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –≤—ã–¥–µ–ª–µ–Ω–∏–µ –ø–æ—Ä—Ç–æ–≤** ‚úÖ
- **Web —Ä–µ–∂–∏–º**: `find_free_port()` –≤ `run.py`
- **Desktop —Ä–µ–∂–∏–º**: WSGI —Å–µ—Ä–≤–µ—Ä —Å –ø–æ—Ä—Ç–æ–º 0 –≤ `desktop/window.py`
- **–ö–æ–¥:**
  ```python
  _WSGI_SERVER = make_server('127.0.0.1', 0, app)
  SERVER_PORT = _WSGI_SERVER.server_port
  ```

### 2. **–£–Ω–∏–∫–∞–ª—å–Ω—ã–µ cookie-—Å–µ—Å—Å–∏–∏** ‚úÖ
- **–§–∞–π–ª:** `app/__init__.py:214`
- **–ö–æ–¥:**
  ```python
  app.config['SESSION_COOKIE_NAME'] = 'vpn_manager_session_clean'
  ```

### 3. **–ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö** ‚úÖ
- **–§–∞–π–ª:** `app/config.py:8-46`
- **–§—É–Ω–∫—Ü–∏—è:** `get_app_data_dir()`
- **–ü–æ–¥–¥–µ—Ä–∂–∫–∞:**
  - macOS: `~/Library/Application Support/VPNServerManager-Clean`
  - Windows: `%APPDATA%\VPNServerManager-Clean`
  - Linux: `~/.local/share/VPNServerManager-Clean`
  - Dev: —Ç–µ–∫—É—â–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –ø—Ä–æ–µ–∫—Ç–∞

### 4. **–ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ SERVER_PORT** ‚úÖ
- **–§–∞–π–ª:** `desktop/window.py:14-15`
- **–ö–æ–¥:**
  ```python
  SERVER_PORT = None
  _WSGI_SERVER = None
  ```

### 5. **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ URL –≤ pywebview** ‚úÖ
- **–§–∞–π–ª:** `desktop/window.py:79`
- **–ö–æ–¥:**
  ```python
  self.window = webview.create_window(
      'VPN Server Manager - Clean',
      f'http://127.0.0.1:{SERVER_PORT}',  # –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –ø–æ—Ä—Ç!
      ...
  )
  ```

### 6. **–ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ (/shutdown)** ‚úÖ
- **–§–∞–π–ª:** `app/routes/main.py:905-913`
- **–≠–Ω–¥–ø–æ–∏–Ω—Ç:** `GET /shutdown`
- **–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∑–∞–∫—Ä—ã—Ç–∏—è:** `desktop/window.py:103-123`

---

## üß™ –¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ó–∞–ø—É—Å–∫ –æ–¥–Ω–æ–≥–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ (web —Ä–µ–∂–∏–º)
```bash
# –¢–µ—Ä–º–∏–Ω–∞–ª 1
source venv/bin/activate
python run.py

# –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
# üåê VPN Server Manager v4.0.0
# üì° Web server: http://127.0.0.1:5000
# ‚úÖ –ü–æ—Ä—Ç 5000 (–∏–ª–∏ –ø–µ—Ä–≤—ã–π —Å–≤–æ–±–æ–¥–Ω—ã–π)
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ó–∞–ø—É—Å–∫ –¥–≤—É—Ö —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ (web —Ä–µ–∂–∏–º)
```bash
# –¢–µ—Ä–º–∏–Ω–∞–ª 1
source venv/bin/activate
python run.py
# –ü–æ—Ä—Ç: 5000

# –¢–µ—Ä–º–∏–Ω–∞–ª 2
source venv/bin/activate
python run.py
# –ü–æ—Ä—Ç: 5001 (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏!)

# –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
# ‚úÖ –û–±–∞ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ
# ‚úÖ –†–∞–∑–Ω—ã–µ –ø–æ—Ä—Ç—ã (5000 –∏ 5001)
# ‚úÖ –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–µ—Å—Å–∏–∏ (cookie: vpn_manager_session_clean)
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ó–∞–ø—É—Å–∫ desktop —Ä–µ–∂–∏–º–∞
```bash
# –¢–µ—Ä–º–∏–Ω–∞–ª 1
source venv/bin/activate
python run.py --desktop

# –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
# üöÄ Flask —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ http://127.0.0.1:XXXXX
# ‚úÖ –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –ø–æ—Ä—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, 52341)
# ‚úÖ –û–∫–Ω–æ pywebview –æ—Ç–∫—Ä—ã—Ç–æ
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 4: –î–≤–∞ desktop —ç–∫–∑–µ–º–ø–ª—è—Ä–∞
```bash
# –¢–µ—Ä–º–∏–Ω–∞–ª 1
source venv/bin/activate
python run.py --desktop
# –ü–æ—Ä—Ç: 52341 (–ø—Ä–∏–º–µ—Ä)

# –¢–µ—Ä–º–∏–Ω–∞–ª 2
source venv/bin/activate
python run.py --desktop
# –ü–æ—Ä—Ç: 52342 (–ø—Ä–∏–º–µ—Ä)

# –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
# ‚úÖ –î–≤–∞ –æ–∫–Ω–∞ pywebview
# ‚úÖ –†–∞–∑–Ω—ã–µ –ø–æ—Ä—Ç—ã
# ‚úÖ –ù–µ–∑–∞–≤–∏—Å–∏–º—ã–µ —Å–µ—Å—Å–∏–∏ –∏ –¥–∞–Ω–Ω—ã–µ
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 5: –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ
```bash
# –í desktop —Ä–µ–∂–∏–º–µ
1. –ó–∞–∫—Ä—ã—Ç—å –æ–∫–Ω–æ –∫–Ω–æ–ø–∫–æ–π ‚ùå
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏:
   - "–û–∫–Ω–æ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è, –æ—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –≤—ã–∫–ª—é—á–µ–Ω–∏–µ..."
   - "WSGI —Å–µ—Ä–≤–µ—Ä –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—Ä—Ç:
   lsof -i :XXXXX
   # –ü–æ—Ä—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω!

# –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
# ‚úÖ –ü–æ—Ä—Ç –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω
# ‚úÖ –ü—Ä–æ—Ü–µ—Å—Å –∑–∞–≤–µ—Ä—à–µ–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
# ‚úÖ –ù–µ—Ç –∑–∞–≤–∏—Å—à–∏—Ö –ø–æ—Ç–æ–∫–æ–≤
```

---

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –¢–µ—Å—Ç 1: Web —Ä–µ–∂–∏–º (–æ–¥–∏–Ω —ç–∫–∑–µ–º–ø–ª—è—Ä)
- **–°—Ç–∞—Ç—É—Å:** ‚è≥ –û–∂–∏–¥–∞–µ—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- **–ü–æ—Ä—Ç:** -
- **–í—Ä–µ–º—è –∑–∞–ø—É—Å–∫–∞:** -
- **–ü—Ä–æ–±–ª–µ–º—ã:** -

### –¢–µ—Å—Ç 2: Web —Ä–µ–∂–∏–º (–¥–≤–∞ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞)
- **–°—Ç–∞—Ç—É—Å:** ‚è≥ –û–∂–∏–¥–∞–µ—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- **–ü–æ—Ä—Ç—ã:** -
- **–ò–∑–æ–ª—è—Ü–∏—è —Å–µ—Å—Å–∏–π:** -
- **–ü—Ä–æ–±–ª–µ–º—ã:** -

### –¢–µ—Å—Ç 3: Desktop —Ä–µ–∂–∏–º (–æ–¥–∏–Ω —ç–∫–∑–µ–º–ø–ª—è—Ä)
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ **–£–°–ü–ï–®–ù–û**
- **–ü–æ—Ä—Ç:** 50473 (–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω –û–°)
- **–í—Ä–µ–º—è –∑–∞–ø—É—Å–∫–∞:** ~0.4 —Å–µ–∫—É–Ω–¥—ã
- **–ü—Ä–æ–±–ª–µ–º—ã:** –ù–µ—Ç
- **–î–µ—Ç–∞–ª–∏:**
  - WSGI —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω —Å –ø–æ—Ä—Ç–æ–º 0
  - –û–° –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞–∑–Ω–∞—á–∏–ª–∞ –ø–æ—Ä—Ç 50473
  - –û–∫–Ω–æ pywebview –æ—Ç–∫—Ä—ã–ª–æ—Å—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
  - –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ –∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç

### –¢–µ—Å—Ç 4: Desktop —Ä–µ–∂–∏–º (–¥–≤–∞ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞)
- **–°—Ç–∞—Ç—É—Å:** ‚è≥ –û–∂–∏–¥–∞–µ—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- **–ü–æ—Ä—Ç—ã:** -
- **–ò–∑–æ–ª—è—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö:** -
- **–ü—Ä–æ–±–ª–µ–º—ã:** -

### –¢–µ—Å—Ç 5: –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ
- **–°—Ç–∞—Ç—É—Å:** ‚è≥ –û–∂–∏–¥–∞–µ—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- **–û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –ø–æ—Ä—Ç–æ–≤:** -
- **–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤:** -
- **–ü—Ä–æ–±–ª–µ–º—ã:** -

---

## üîß –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–Ω—è—Ç—ã—Ö –ø–æ—Ä—Ç–æ–≤
```bash
# macOS/Linux
lsof -i :5000
lsof -i :5001
netstat -an | grep LISTEN

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö –ø–æ—Ä—Ç–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
lsof -i | grep Python
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
```bash
# –ü–æ–∏—Å–∫ –≤—Å–µ—Ö —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤
ps aux | grep "python.*run.py"

# –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
ps -ef | grep "VPNServerManager"
```

### –û—á–∏—Å—Ç–∫–∞ –∑–∞–≤–∏—Å—à–∏—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
```bash
# –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø–æ –ø–æ—Ä—Ç—É
kill -9 $(lsof -t -i:5000)

# –û—á–∏—Å—Ç–∫–∞ –≤—Å–µ—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ Python
pkill -f "run.py"
```

---

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

1. **Cookie –∏–∑–æ–ª—è—Ü–∏—è:**
   - –ò–º—è: `vpn_manager_session_clean`
   - –î–æ–º–µ–Ω: `127.0.0.1`
   - Scope: –õ–æ–∫–∞–ª—å–Ω—ã–π (HttpOnly, SameSite=Lax)

2. **–î–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–∞–Ω–Ω—ã—Ö:**
   - Dev —Ä–µ–∂–∏–º: `./data`, `./uploads`, `./logs`
   - Production (macOS): `~/Library/Application Support/VPNServerManager-Clean`

3. **–ü–æ—Ä—Ç—ã:**
   - Web —Ä–µ–∂–∏–º: –Ω–∞—á–∏–Ω–∞—è —Å 5000, –∞–≤—Ç–æ–ø–æ–∏—Å–∫ —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ
   - Desktop —Ä–µ–∂–∏–º: OS –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (–ø–æ—Ä—Ç 0)

4. **WSGI —Å–µ—Ä–≤–µ—Ä:**
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `wsgiref.simple_server.make_server`
   - –ü–æ—Ç–æ–∫–æ–≤—ã–π —Ä–µ–∂–∏–º (daemon=True)
   - Graceful shutdown —á–µ—Ä–µ–∑ `_WSGI_SERVER.shutdown()`

---

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞

1. ‚úÖ –î–≤–∞ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –±–µ–∑ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –ø–æ—Ä—Ç–æ–≤
2. ‚úÖ –°–µ—Å—Å–∏–∏ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω—ã (—Ä–∞–∑–Ω—ã–µ cookie)
3. ‚úÖ –î–∞–Ω–Ω—ã–µ –Ω–µ —Å–º–µ—à–∏–≤–∞—é—Ç—Å—è (—Ä–∞–∑–Ω—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –∏–ª–∏ —Ñ–∞–π–ª—ã)
4. ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç –ø–æ—Ä—Ç—ã
5. ‚úÖ –ù–µ—Ç –∑–∞–≤–∏—Å—à–∏—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –ø–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è
6. ‚úÖ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–µ –¥–µ–≥—Ä–∞–¥–∏—Ä—É–µ—Ç –ø—Ä–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç–µ

---

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã** –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤—ã—à–µ
2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–∑–æ–ª—è—Ü–∏—é cookie** —á–µ—Ä–µ–∑ Developer Tools –±—Ä–∞—É–∑–µ—Ä–∞
3. **–ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å —Ä–µ—Å—É—Ä—Å—ã** (RAM, CPU) –ø—Ä–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç–µ
4. **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã** –µ—Å–ª–∏ –æ–Ω–∏ –≤–æ–∑–Ω–∏–∫–Ω—É—Ç
5. **–û–±–Ω–æ–≤–∏—Ç—å CHANGELOG.md** —Å –Ω–æ–≤—ã–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏

---

**–°—Ç–∞—Ç—É—Å –¥–æ–∫—É–º–µ–Ω—Ç–∞:** üìù –°–æ–∑–¥–∞–Ω, –æ–∂–∏–¥–∞–µ—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è  
**–ê–≤—Ç–æ—Ä:** AI Assistant  
**–í–µ—Ä—Å–∏—è:** 1.0

