# üîê –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–æ PIN

## ‚úÖ –ü—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–µ–Ω–∞! (11 –æ–∫—Ç—è–±—Ä—è 2025, 11:08)

### üêõ **–ü—Ä–æ–±–ª–µ–º–∞:**
PIN `1234` –Ω–µ —Ä–∞–±–æ—Ç–∞–ª –≤ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ - –æ—à–∏–±–∫–∞ `500 INTERNAL SERVER ERROR`.

### üîç **–ü—Ä–∏—á–∏–Ω–∞:**
–ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ñ–æ—Ä–º–∞—Ç–æ–≤ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É JavaScript –∏ API:
- **JavaScript** –≤ `layout.html` –æ—Ç–ø—Ä–∞–≤–ª—è–ª –¥–∞–Ω–Ω—ã–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ `application/x-www-form-urlencoded`
- **API** (`app/routes/api.py`) –æ–∂–∏–¥–∞–ª –¥–∞–Ω–Ω—ã–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ `application/json`
- **JavaScript** –≤ `index_locked.html` —É–∂–µ –±—ã–ª –∏—Å–ø—Ä–∞–≤–ª–µ–Ω, –Ω–æ `layout.html` –æ—Å—Ç–∞–ª—Å—è —Å–æ —Å—Ç–∞—Ä—ã–º —Ñ–æ—Ä–º–∞—Ç–æ–º

### üõ†Ô∏è **–†–µ—à–µ–Ω–∏–µ:**

#### 1. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω JavaScript –≤ —à–∞–±–ª–æ–Ω–µ:**
```javascript
// –ë–´–õ–û:
fetch('/pin/login_ajax', {
    method: 'POST',
    headers: {
        'Content-Type': 'application/x-www-form-urlencoded',
    },
    body: `pin=${encodeURIComponent(pin)}`
})

// –°–¢–ê–õ–û:
fetch('/pin/login_ajax', {
    method: 'POST',
    headers: {
        'Content-Type': 'application/json',
    },
    body: JSON.stringify({pin: pin})
})
```

#### 2. **–£–ø—Ä–æ—â–µ–Ω API endpoint:**
```python
@pin_bp.route('/login_ajax', methods=['POST'])
def login_ajax():
    # –ü–æ–ª—É—á–∞–µ–º PIN –∏–∑ JSON
    data = request.get_json()
    pin = data.get('pin', '').strip()
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º PIN –∏–∑ config.json
    current_pin = get_secret_pin()  # –ß–∏—Ç–∞–µ—Ç –∏–∑ config.json
    
    if pin == current_pin:
        session['pin_authenticated'] = True
        return jsonify({'success': True, 'message': 'Login successful'})
    else:
        # –õ–æ–≥–∏–∫–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø–æ—Å–ª–µ 3 –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫
        return jsonify({'success': False, 'error': 'Invalid PIN'})
```

### üß™ **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**

#### ‚úÖ **API —Ç–µ—Å—Ç (—É—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥):**
```bash
curl -X POST -H "Content-Type: application/json" -d '{"pin":"1234"}' http://127.0.0.1:5000/pin/login_ajax
# –†–µ–∑—É–ª—å—Ç–∞—Ç: {"message":"Login successful","success":true}
```

#### ‚úÖ **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π PIN (—Å –ø–æ–¥—Å—á–µ—Ç–æ–º –ø–æ–ø—ã—Ç–æ–∫):**
```bash
curl -X POST -H "Content-Type: application/json" -d '{"pin":"0000"}' http://127.0.0.1:5000/pin/login_ajax
# –†–µ–∑—É–ª—å—Ç–∞—Ç: {"attempts_left":2,"error":"Invalid PIN","success":false}
```

#### ‚úÖ **–í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å:**
–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è `layout.html`:
- –û—Ç–∫—Ä—ã—Ç—å http://127.0.0.1:5000/locked
- –í–≤–µ—Å—Ç–∏ PIN `1234`
- –£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥ –∏ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É

### üéØ **–†–µ–∑—É–ª—å—Ç–∞—Ç:**

**PIN –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ!**

- ‚úÖ PIN `1234` –ø—Ä–∏–Ω–∏–º–∞–µ—Ç—Å—è
- ‚úÖ –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ PIN –æ—Ç–∫–ª–æ–Ω—è—é—Ç—Å—è
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç (3 –ø–æ–ø—ã—Ç–∫–∏ ‚Üí –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –Ω–∞ 30 —Å–µ–∫)
- ‚úÖ –î–∞–Ω–Ω—ã–µ —á–∏—Ç–∞—é—Ç—Å—è –∏–∑ `config.json`
- ‚úÖ –°–µ—Å—Å–∏—è —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ

### üåê **–î–æ—Å—Ç—É–ø –∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é:**
```
URL: http://127.0.0.1:5000
PIN: 1234
```

### üìã **–§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã:**
- `templates/layout.html` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω JavaScript (–∏–∑–º–µ–Ω–µ–Ω —Ñ–æ—Ä–º–∞—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å form-urlencoded –Ω–∞ JSON)
- `templates/index_locked.html` - —É–∂–µ –±—ã–ª –∏—Å–ø—Ä–∞–≤–ª–µ–Ω —Ä–∞–Ω–µ–µ
- `app/routes/api.py` - –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –æ–±–∞ —Ñ–æ—Ä–º–∞—Ç–∞ (JSON –∏ form-data) –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏

---

**–°—Ç–∞—Ç—É—Å**: ‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–û**  
**–î–∞—Ç–∞**: 11 –æ–∫—Ç—è–±—Ä—è 2025  
**–í–µ—Ä—Å–∏—è**: 4.0.0
