# Инструкции по сборке VPN Server Manager

Этот документ содержит подробные инструкции по созданию приложения VPN Server Manager для macOS.

## Требования

### Общие требования
- Python 3.8 или выше
- Установленный pip
- PyInstaller (`pip install pyinstaller`)

### Для macOS
- macOS 10.14 или выше
- Xcode Command Line Tools (запустите `xcode-select --install`)
- Утилита `iconutil` (встроена в macOS)
- Утилита `sips` (встроена в macOS)

## Подготовка к сборке

1. Клонируйте или загрузите репозиторий проекта
2. Создайте и активируйте виртуальное окружение:
   ```bash
   python3 -m venv venv
   source venv/bin/activate
   ```
3. Установите необходимые зависимости:
   ```bash
   pip install -r requirements.txt
   pip install pyinstaller
   ```

## Сборка для macOS

### Подготовка иконки
1. Создайте иконку для приложения в формате .png
2. Поместите файл `icon.png` в папку `static/images/`
3. Скрипт автоматически создаст `.icns` файл из PNG

### Создание .app и .dmg
1. Перейдите в корневую директорию проекта
2. Запустите скрипт сборки:
   ```bash
   python3 build_macos.py
   ```
3. После успешной сборки в папке `dist/` будет создан `.app` бундл и `.dmg` установочный образ

### Структура собранного приложения

Готовое приложение содержит следующие элементы:
- Исполняемый файл приложения
- Встроенные зависимости Python
- Статические ресурсы (CSS, изображения, иконки)
- HTML-шаблоны интерфейса

### Портативность данных

Данные пользователя (серверы, ключи шифрования, загрузки) сохраняются в стандартных местах macOS:
- **Данные приложения**: `~/Library/Application Support/VPNServerManager/`
- **Конфигурация**: `config.json` в папке приложения
- **Зашифрованные данные**: `data/servers.json.enc`
- **Загруженные файлы**: `uploads/`
- **Ключ шифрования**: `.env` файл

## Новые функции в сборке

### Масштабирование интерфейса
Встроенная поддержка изменения масштаба интерфейса (80%, 90%, 100%) с сохранением настроек в cookies браузера.

### Импорт из других установок
Возможность импорта данных из других установок с использованием внешних ключей шифрования.

### Улучшенная безопасность
- Все пароли зашифрованы алгоритмом Fernet (AES-128 + HMAC-SHA256)
- Автоматическая генерация уникального ключа шифрования при первом запуске
- Защита от подделки данных

## Распространение

### Через DMG-образ
Создается установочный образ `.dmg` с красивым интерфейсом установки и автоматическим копированием в папку Applications.

### Требования для распространения
- Для публичного распространения рекомендуется нотаризация через Apple Developer Program
- Приложение поддерживает архитектуры Intel x86_64 и Apple Silicon (с соответствующими зависимостями)

## Решение проблем

### Проблемы со сборкой
- Убедитесь, что у вас установлены Xcode Command Line Tools
- Проверьте, что виртуальное окружение активировано
- Убедитесь, что все зависимости установлены корректно

### Проблемы с иконками
- Если возникают проблемы с созданием иконки, проверьте наличие `iconutil`
- Убедитесь, что исходный файл `icon.png` имеет разрешение не менее 512x512 пикселей

### Проблемы с DMG
- Если создание DMG не работает, можно использовать приложение напрямую из папки `dist/`
- Для альтернативного создания DMG используйте Disk Utility или сторонние инструменты

## Структура проекта после сборки

```
dist/
├── VPNServerManager.app/     # Готовое приложение
│   ├── Contents/
│   │   ├── MacOS/           # Исполняемые файлы
│   │   ├── Resources/       # Ресурсы и зависимости
│   │   └── Info.plist       # Метаданные приложения
│   └── ...
└── VPNServerManager.dmg     # Установочный образ
```

## Дополнительные замечания

- Приложение автоматически создает необходимые директории данных при первом запуске
- Все пользовательские данные хранятся отдельно от исполняемых файлов
- Для переноса данных между компьютерами используйте функцию экспорта/импорта в настройках
- Рекомендуется создавать резервные копии ключа шифрования (`.env` файл) для восстановления данных 