# Урок 2: Ветки и слияния в Git и GitHub

В этом уроке мы подробно рассмотрим работу с ветками в Git и GitHub, а также процесс слияния изменений между ветками.

## Концепция ветвления в Git

Ветвление (branching) — это одна из самых мощных функций Git. Ветки позволяют разработчикам работать над разными задачами параллельно, не мешая друг другу. Каждая ветка представляет собой отдельную линию разработки, которая может развиваться независимо от других веток.

### Зачем нужны ветки?

- **Изоляция изменений**: работа над новыми функциями без влияния на основной код
- **Параллельная разработка**: несколько разработчиков могут работать над разными задачами одновременно
- **Экспериментирование**: тестирование идей без риска для стабильной версии
- **Организация релизов**: отдельные ветки для разных версий продукта
- **Исправление ошибок**: быстрое создание исправлений для продакшн-версии

## Основные команды для работы с ветками

### Просмотр веток

```bash
# Просмотр локальных веток
git branch

# Просмотр всех веток (включая удаленные)
git branch -a

# Просмотр удаленных веток
git branch -r

# Подробная информация о ветках
git branch -v
```

### Создание новой ветки

```bash
# Создание новой ветки
git branch feature-name

# Создание и переключение на новую ветку
git checkout -b feature-name

# Создание ветки от определенного коммита
git checkout -b feature-name commit-hash

# Создание ветки от тега
git checkout -b feature-name tag-name
```

### Переключение между ветками

```bash
# Переключение на существующую ветку
git checkout branch-name

# Переключение на предыдущую ветку
git checkout -
```

### Переименование и удаление веток

```bash
# Переименование текущей ветки
git branch -m new-name

# Переименование указанной ветки
git branch -m old-name new-name

# Удаление ветки (после слияния)
git branch -d branch-name

# Принудительное удаление ветки (без слияния)
git branch -D branch-name
```

## Работа с удаленными ветками

### Публикация локальной ветки на GitHub

```bash
# Отправка ветки в удаленный репозиторий
git push origin branch-name

# Установка связи между локальной и удаленной веткой
git push -u origin branch-name
```

### Получение удаленных веток

```bash
# Получение информации об удаленных ветках
git fetch origin

# Получение конкретной ветки
git fetch origin branch-name

# Создание локальной ветки на основе удаленной
git checkout -b local-branch origin/remote-branch

# Или проще (если имена совпадают)
git checkout --track origin/branch-name
```

### Удаление удаленной ветки

```bash
# Удаление ветки на GitHub
git push origin --delete branch-name

# Альтернативный синтаксис
git push origin :branch-name
```

## Слияние веток (Merge)

Слияние (merge) — это процесс объединения изменений из разных веток. Обычно используется для включения изменений из функциональной ветки в основную ветку (например, main или develop).

### Базовое слияние

```bash
# Переключение на целевую ветку (куда вливаем изменения)
git checkout main

# Слияние другой ветки в текущую
git merge feature-branch

# Слияние с указанием сообщения коммита
git merge feature-branch -m "Merge feature-branch into main"
```

### Типы слияний

1. **Fast-forward merge** (слияние перемоткой):
   - Происходит, когда целевая ветка не имеет собственных коммитов после точки ветвления
   - История линейная, без дополнительных коммитов слияния

2. **Recursive merge** (рекурсивное слияние):
   - Создает новый коммит слияния с двумя родителями
   - Используется, когда обе ветки имеют уникальные коммиты

3. **Squash merge** (сжатие коммитов):
   - Объединяет все коммиты из вливаемой ветки в один
   - Упрощает историю, но теряется детализация

```bash
# Squash merge
git merge --squash feature-branch
git commit -m "Merged feature-branch with squash"
```

### Разрешение конфликтов слияния

Конфликты возникают, когда одни и те же строки были изменены в обеих ветках. Git не может автоматически решить, какие изменения сохранить.

```bash
# При возникновении конфликта Git приостановит слияние
# Файлы с конфликтами будут помечены в выводе git status

# Открытие файлов с конфликтами и их редактирование
# Конфликты обозначаются маркерами:
# <<<<<<< HEAD
# Изменения в текущей ветке
# =======
# Изменения в сливаемой ветке
# >>>>>>> feature-branch

# После разрешения конфликтов
git add resolved-file.txt
git commit  # Git подготовит сообщение коммита слияния
```

### Отмена слияния

```bash
# Если слияние еще не завершено (в процессе разрешения конфликтов)
git merge --abort

# Если слияние уже завершено
git reset --hard HEAD~1  # Возврат на один коммит назад
```

## Rebase: альтернатива слиянию

Rebase (перебазирование) — это альтернативный способ интеграции изменений между ветками. В отличие от слияния, rebase переносит коммиты из одной ветки в другую, создавая линейную историю.

```bash
# Находясь в ветке feature-branch
git rebase main

# Если возникают конфликты, Git приостановит rebase
# После разрешения конфликтов
git add resolved-file.txt
git rebase --continue

# Отмена rebase
git rebase --abort
```

### Когда использовать merge, а когда rebase?

- **Merge**:
  - Для интеграции завершенных функций в основную ветку
  - Когда важно сохранить точную историю разработки
  - Для публичных веток, которые используют другие разработчики

- **Rebase**:
  - Для обновления функциональной ветки последними изменениями из основной ветки
  - Для создания чистой, линейной истории
  - Для локальных веток, которые еще не опубликованы

> ⚠️ **Важно**: Никогда не делайте rebase для веток, которые уже опубликованы и используются другими разработчиками, так как это изменяет историю и создает проблемы при синхронизации.

## Работа с ветками на GitHub

### Защита веток

На GitHub можно настроить защиту важных веток (например, main):

1. Перейдите в репозиторий → Settings → Branches
2. Нажмите "Add rule" рядом с "Branch protection rules"
3. Укажите имя ветки и настройте правила:
   - Require pull request reviews before merging
   - Require status checks to pass before merging
   - Require signed commits
   - Include administrators
   - Restrict who can push to matching branches

### Стратегии ветвления

#### GitHub Flow

Простая модель с одной основной веткой (main):
1. Создайте ветку от main для новой функции/исправления
2. Внесите изменения и коммиты
3. Откройте Pull Request
4. Обсудите и доработайте изменения
5. Слейте изменения в main через Pull Request
6. Удалите ветку функции

#### Git Flow

Более сложная модель с несколькими постоянными ветками:
- `main` — стабильные релизы
- `develop` — текущая разработка
- `feature/*` — новые функции
- `release/*` — подготовка релиза
- `hotfix/*` — срочные исправления для продакшн

## Практические примеры

### Пример 1: Разработка новой функции

```bash
# Создание ветки для новой функции
git checkout -b feature/user-authentication main

# Внесение изменений и коммиты
touch auth.js
git add auth.js
git commit -m "Add user authentication module"

# Обновление ветки последними изменениями из main
git checkout main
git pull
git checkout feature/user-authentication
git rebase main

# Отправка ветки на GitHub
git push -u origin feature/user-authentication

# Создание Pull Request (через веб-интерфейс GitHub)
# После одобрения и слияния на GitHub

# Удаление локальной ветки после слияния
git checkout main
git pull  # Получение обновленного main
git branch -d feature/user-authentication
```

### Пример 2: Исправление срочной ошибки (hotfix)

```bash
# Создание ветки для исправления от продакшн-версии
git checkout -b hotfix/login-error main

# Исправление ошибки
git commit -am "Fix login error on production"

# Отправка на GitHub
git push -u origin hotfix/login-error

# После проверки и слияния на GitHub
git checkout main
git pull
git branch -d hotfix/login-error
```

## Заключение

Ветки — это мощный инструмент для организации разработки в Git и GitHub. Правильное использование веток и стратегий слияния позволяет эффективно работать в команде, поддерживать стабильность кода и быстро внедрять новые функции.

В следующем уроке мы рассмотрим работу с Pull Requests на GitHub и научимся эффективно организовывать процесс проверки кода.

## Дополнительные ресурсы

- [Git Branching - Basic Branching and Merging](https://git-scm.com/book/en/v2/Git-Branching-Basic-Branching-and-Merging)
- [GitHub Flow Guide](https://guides.github.com/introduction/flow/)
- [A successful Git branching model (Git Flow)](https://nvie.com/posts/a-successful-git-branching-model/)
- [Atlassian Git Tutorial - Comparing Workflows](https://www.atlassian.com/git/tutorials/comparing-workflows) 