# Урок 3: Pull Requests в GitHub

В этом уроке мы подробно рассмотрим Pull Requests — один из ключевых инструментов GitHub для организации совместной работы над кодом.

## Что такое Pull Request?

Pull Request (PR) — это механизм GitHub, который позволяет разработчикам предлагать изменения в репозиторий. Pull Request представляет собой запрос на включение изменений из одной ветки в другую, обычно из функциональной ветки в основную ветку проекта (например, main).

### Основные преимущества Pull Requests:

- **Код-ревью**: другие участники могут просматривать, комментировать и предлагать улучшения
- **Обсуждение**: возможность обсуждать изменения до их включения в основную кодовую базу
- **Автоматизация**: интеграция с CI/CD, автоматические проверки кода
- **Документация**: PR сохраняет историю изменений и обсуждений
- **Контроль качества**: обеспечивает дополнительный уровень проверки перед слиянием

## Создание Pull Request

### Подготовка к созданию PR

1. Убедитесь, что ваши изменения находятся в отдельной ветке:

```bash
# Создание новой ветки
git checkout -b feature/new-feature

# Внесение изменений
# ...

# Коммит изменений
git add .
git commit -m "Add new feature"

# Отправка ветки на GitHub
git push -u origin feature/new-feature
```

### Создание PR через веб-интерфейс GitHub

1. Перейдите на страницу вашего репозитория на GitHub
2. GitHub обычно показывает уведомление о недавно отправленной ветке с кнопкой "Compare & pull request"
3. Если уведомление не появилось:
   - Нажмите на вкладку "Pull requests"
   - Нажмите зеленую кнопку "New pull request"
   - Выберите ветку-источник (feature/new-feature) и целевую ветку (main)
4. Заполните форму создания PR:
   - Заголовок: краткое описание изменений
   - Описание: подробное объяснение изменений, причины и результаты
   - Добавьте любые связанные issues (например, "Closes #123")
5. Нажмите "Create pull request"

### Создание PR с помощью GitHub CLI

```bash
# Создание PR из текущей ветки в main
gh pr create

# Создание PR с заголовком и описанием
gh pr create --title "Add user authentication" --body "This PR adds user authentication using JWT"

# Создание PR и связывание с issue
gh pr create --title "Add user authentication" --body "Closes #123"

# Создание черновика PR
gh pr create --draft
```

## Анатомия Pull Request

Каждый Pull Request на GitHub содержит несколько ключевых элементов:

### 1. Заголовок и описание

- **Заголовок**: краткое описание изменений (до 72 символов)
- **Описание**: подробное объяснение изменений, может включать:
  - Причины изменений
  - Как тестировать
  - Скриншоты или демонстрации
  - Связанные issues

### 2. Изменения (Changes)

- Список файлов, которые были изменены
- Diff каждого файла (добавленные и удаленные строки)
- Возможность комментирования отдельных строк кода

### 3. Обсуждение (Conversation)

- Хронологическая история комментариев и обновлений
- Обсуждения между участниками проекта
- История проверок и утверждений

### 4. Проверки (Checks)

- Результаты автоматизированных проверок (CI/CD)
- Статус проверок: успешно, с ошибками, в процессе

### 5. Метаданные

- Автор PR
- Рецензенты (reviewers)
- Метки (labels)
- Проекты
- Связанные issues

## Рецензирование Pull Request

### Назначение рецензентов

```bash
# Через GitHub CLI
gh pr edit --add-reviewer username1,username2

# Через веб-интерфейс
# Нажмите "Reviewers" в правой панели PR и выберите пользователей
```

### Проведение код-ревью

1. Перейдите на страницу PR
2. Нажмите на вкладку "Files changed"
3. Просмотрите изменения:
   - Добавьте комментарии к отдельным строкам, нажав на "+" рядом с номером строки
   - Добавьте общие комментарии к файлам или всему PR
4. После просмотра нажмите "Review changes" и выберите один из вариантов:
   - **Comment**: просто оставить комментарии без явного одобрения/отклонения
   - **Approve**: одобрить изменения и рекомендовать слияние
   - **Request changes**: запросить изменения перед слиянием

### Код-ревью через GitHub CLI

```bash
# Просмотр PR
gh pr view 123

# Просмотр изменений
gh pr diff 123

# Добавление комментария
gh pr comment 123 --body "Looks good, but please add tests"

# Одобрение PR
gh pr review 123 --approve

# Запрос изменений
gh pr review 123 --request-changes --body "Please fix the formatting issues"
```

## Обновление Pull Request

После получения обратной связи часто требуется внести дополнительные изменения в PR.

```bash
# Переключение на ветку PR
git checkout feature/new-feature

# Внесение изменений
# ...

# Коммит и отправка изменений
git add .
git commit -m "Address review feedback"
git push

# PR автоматически обновится на GitHub
```

### Обновление описания PR

```bash
# Через GitHub CLI
gh pr edit 123 --title "Updated title" --body "Updated description"

# Через веб-интерфейс
# Нажмите "Edit" рядом с заголовком или описанием PR
```

## Слияние Pull Request

### Способы слияния

GitHub предлагает три способа слияния PR:

1. **Create a merge commit**: создает коммит слияния с двумя родителями
   - Сохраняет полную историю ветки
   - Показывает, когда и как изменения были интегрированы

2. **Squash and merge**: объединяет все коммиты PR в один коммит
   - Упрощает историю основной ветки
   - Сохраняет детальное описание всех изменений в сообщении коммита

3. **Rebase and merge**: перебазирует и применяет каждый коммит по отдельности
   - Создает линейную историю
   - Сохраняет индивидуальные коммиты

### Слияние через веб-интерфейс

1. Перейдите на страницу PR
2. Убедитесь, что все проверки прошли успешно и есть необходимые одобрения
3. Нажмите зеленую кнопку "Merge pull request"
4. Выберите способ слияния (merge, squash, rebase)
5. Подтвердите слияние

### Слияние через GitHub CLI

```bash
# Слияние PR с созданием коммита слияния
gh pr merge 123

# Squash-слияние
gh pr merge 123 --squash

# Rebase-слияние
gh pr merge 123 --rebase

# Слияние с удалением ветки
gh pr merge 123 --delete-branch
```

## Закрытие Pull Request без слияния

Иногда PR нужно закрыть без слияния, например, если решение было отклонено или заменено другим подходом.

```bash
# Через GitHub CLI
gh pr close 123

# Через веб-интерфейс
# Нажмите "Close pull request" внизу страницы PR
```

## Повторное открытие закрытого PR

```bash
# Через GitHub CLI
gh pr reopen 123

# Через веб-интерфейс
# Перейдите на страницу закрытого PR и нажмите "Reopen pull request"
```

## Лучшие практики работы с Pull Requests

### Для авторов PR

1. **Делайте PR небольшими и сфокусированными**
   - Один PR = одна функция или исправление
   - Легче проверять, тестировать и сливать

2. **Пишите информативные заголовки и описания**
   - Заголовок должен ясно указывать на цель изменений
   - Описание должно объяснять "что", "почему" и "как"

3. **Связывайте PR с issues**
   - Используйте ключевые слова: "Closes #123", "Fixes #456"
   - Это автоматически закроет issues после слияния PR

4. **Проверяйте свой код перед созданием PR**
   - Запускайте тесты
   - Проверяйте стиль кода
   - Удаляйте отладочный код

5. **Отвечайте на комментарии конструктивно**
   - Благодарите за обратную связь
   - Объясняйте свои решения
   - Будьте открыты к улучшениям

### Для рецензентов

1. **Будьте вежливыми и конструктивными**
   - Фокусируйтесь на коде, а не на авторе
   - Объясняйте причины своих замечаний
   - Предлагайте решения, а не только указывайте на проблемы

2. **Проверяйте разные аспекты кода**
   - Функциональность
   - Производительность
   - Безопасность
   - Читаемость и поддерживаемость
   - Тесты

3. **Не затягивайте с проверкой**
   - Старайтесь проверять PR в течение 1-2 рабочих дней
   - Если не можете провести полную проверку, оставьте частичные комментарии

4. **Используйте инструменты GitHub**
   - Предлагайте конкретные изменения через "suggestion" в комментариях
   - Используйте "Start a review" для группировки комментариев

## Практические примеры

### Пример 1: Полный цикл работы с PR

```bash
# 1. Создание ветки и внесение изменений
git checkout -b feature/add-search
echo "function search() { /* ... */ }" > search.js
git add search.js
git commit -m "Add search functionality"
git push -u origin feature/add-search

# 2. Создание PR
gh pr create --title "Add search functionality" --body "This PR adds search functionality to the application. Closes #42"

# 3. Получение и адресация обратной связи
git checkout feature/add-search
echo "// Add documentation" >> search.js
git commit -am "Add documentation as requested in review"
git push

# 4. Слияние PR после одобрения
gh pr merge --squash --delete-branch
```

### Пример 2: Разрешение конфликтов в PR

```bash
# 1. Проверка наличия конфликтов
gh pr view 123

# 2. Разрешение конфликтов локально
git checkout feature/conflicting-branch
git pull origin main
# Разрешение конфликтов...
git add .
git commit -m "Resolve merge conflicts"
git push

# PR автоматически обновится и конфликты будут разрешены
```

## Заключение

Pull Requests — это мощный инструмент для организации совместной работы над кодом. Они позволяют структурировать процесс разработки, обеспечивают качество кода через код-ревью и сохраняют историю обсуждений и изменений. Правильное использование Pull Requests значительно повышает качество кода и эффективность командной работы.

В следующем уроке мы рассмотрим работу с Issues в GitHub и научимся эффективно отслеживать задачи и ошибки в проекте.

## Дополнительные ресурсы

- [GitHub Docs: About Pull Requests](https://docs.github.com/en/github/collaborating-with-issues-and-pull-requests/about-pull-requests)
- [GitHub Docs: Reviewing Pull Requests](https://docs.github.com/en/github/collaborating-with-issues-and-pull-requests/reviewing-changes-in-pull-requests)
- [GitHub Docs: Incorporating Feedback in Your Pull Request](https://docs.github.com/en/github/collaborating-with-issues-and-pull-requests/incorporating-feedback-in-your-pull-request)
- [How to Write the Perfect Pull Request](https://github.blog/2015-01-21-how-to-write-the-perfect-pull-request/) 