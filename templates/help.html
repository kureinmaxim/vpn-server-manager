{% extends "layout.html" %}

{% block title %}Справка - {{ super() }}{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-10">
        <h1 class="mb-4">{{ _('Справка по использованию') }}</h1>
        <div class="accordion" id="helpAccordion">

            <div class="accordion-item">
                <h2 class="accordion-header">
                    <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne">
                        {{ _('Добавление нового сервера') }}
                    </button>
                </h2>
                <div id="collapseOne" class="accordion-collapse collapse show" data-bs-parent="#helpAccordion">
                    <div class="accordion-body">
                        {{ _('Нажмите кнопку "Добавить сервер" на главной странице. Заполните все необходимые поля. Пароли будут автоматически зашифрованы перед сохранением. Вы также можете прикрепить файл (например, чек об оплате).') }}
                    </div>
                </div>
            </div>

            <div class="accordion-item">
                <h2 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo">
                        {{ _('Управление паролями и SSH') }}
                    </button>
                </h2>
                <div id="collapseTwo" class="accordion-collapse collapse" data-bs-parent="#helpAccordion">
                    <div class="accordion-body">
                        <p class="alert alert-info">{{ _('Пароли намеренно не отображаются в открытом виде для безопасности. Чтобы увидеть сохраненный пароль, используйте иконку глаза.') }}</p>
                        <ul>
                            <li><strong>{{ _('Отображение пароля:') }}</strong> {{ _('На главной странице, рядом со скрытым паролем, нажмите на иконку глаза') }} <i class="bi bi-eye"></i>, {{ _('чтобы временно его показать.') }}</li>
                            <li><strong>{{ _('Копирование данных:') }}</strong> {{ _('Нажмите на иконку') }} <i class="bi bi-clipboard"></i>, {{ _('чтобы безопасно скопировать логин, пароль или URL в буфер обмена.') }}</li>
                            <li><strong>{{ _('SSH-команда:') }}</strong> {{ _('Нажмите кнопку') }} <i class="bi bi-terminal"></i> {{ _('"Копировать SSH", чтобы получить готовую команду для вставки в терминал.') }}</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="accordion-item">
                <h2 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree">
                        {{ _('Редактирование и удаление') }}
                    </button>
                </h2>
                <div id="collapseThree" class="accordion-collapse collapse" data-bs-parent="#helpAccordion">
                    <div class="accordion-body">
                        {{ _('Используйте кнопки "Редактировать" и "Удалить" на карточке каждого сервера. При удалении потребуется подтверждение. При редактировании вы можете оставить поле пароля пустым, чтобы не изменять его.') }}
                    </div>
                </div>
            </div>

            <div class="accordion-item">
                <h2 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFour">
                        {{ _('Безопасность и хранение паролей') }}
                    </button>
                </h2>
                <div id="collapseFour" class="accordion-collapse collapse" data-bs-parent="#helpAccordion">
                    <div class="accordion-body">
                        <p>{{ _('Безопасность данных является ключевым аспектом этого приложения. Вот как реализована защита ваших данных:') }}</p>
                        <ul class="list-group">
                            <li class="list-group-item list-group-item-success">
                                <h6><i class="bi bi-shield-check"></i> {{ _('SSH, Панель, Хостер (Пароли) - Высокий уровень') }}</h6>
                                <p class="mb-0">{{ _('Все пароли (для SSH, панели управления и кабинета хостера) хранятся в файле') }} <code>data/servers.json</code> {{ _('в') }} <strong>{{ _('зашифрованном виде') }}</strong> {{ _('с использованием надежного алгоритма. Для шифрования используется секретный ключ из файла') }} <code>.env</code>, {{ _('который должен храниться в строгой тайне.') }}</p>
                            </li>
                             <li class="list-group-item list-group-item-warning">
                                <h6><i class="bi bi-eye-slash"></i> {{ _('URL Панелей - Низкий уровень') }}</h6>
                                <p class="mb-0">{{ _('URL-адреса панелей управления и кабинетов хостера хранятся в') }} <strong>{{ _('открытом виде') }}</strong>. {{ _('Они не шифруются, но на главной странице их пути маскируются для защиты от случайных взглядов.') }}</p>
                            </li>
                            <li class="list-group-item list-group-item-info">
                                <h6><i class="bi bi-unlock"></i> {{ _('Расшифровка') }}</h6>
                                <p class="mb-0">{{ _('Все зашифрованные данные расшифровываются "на лету" только в момент их отображения на странице или при копировании в буфер обмена. В файле они всегда остаются зашифрованными.') }}</p>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="accordion-item">
                <h2 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFive">
                        {{ _('Диагностика и проверка IP') }}
                    </button>
                </h2>
                <div id="collapseFive" class="accordion-collapse collapse" data-bs-parent="#helpAccordion">
                    <div class="accordion-body">
                        <p>{{ _('Приложение включает в себя инструменты для быстрой диагностики сети и серверов.') }}</p>
                        <ul>
                            <li><strong>{{ _('Тест IP и DNS:') }}</strong> {{ _('Вверху главной страницы находятся кнопки "Тест IP" и "Тест DNS", которые ведут на внешние сервисы') }} `browserleaks.com` {{ _('и') }} `dnsleaktest.com` {{ _('для проверки вашего текущего сетевого подключения.') }}</li>
                            <li><strong>{{ _('Автоматическая геолокация:') }}</strong> {{ _('При добавлении или редактировании сервера приложение автоматически определяет его геолокацию (страну и город) по IP-адресу и отображает её в шапке карточки.') }}</li>
                            <li><strong>{{ _('Проверка IP сервера:') }}</strong> {{ _('На каждой карточке есть кнопка') }} <i class="bi bi-search"></i> {{ _('"Проверить IP". При нажатии на неё открывается всплывающее окно с подробной информацией об IP-адресе сервера от сервиса') }} `ipinfo.io`, {{ _('включая данные об организации и хостинге.') }}</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="accordion-item">
                <h2 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSix">
                        Индекс пригодности для стриминга
                    </button>
                </h2>
                <div id="collapseSix" class="accordion-collapse collapse" data-bs-parent="#helpAccordion">
                    <div class="accordion-body">
                        <p>На карточке каждого сервера есть строка с тремя индикаторами, которые помогают быстро оценить, подходит ли IP-адрес для использования со стриминговыми сервисами, имеющими геолокационные ограничения (например, 9Now, Hulu, BBC iPlayer).</p>
                        <dl>
                            <dt><span class="badge bg-success">ISP/Residential</span> / <span class="badge bg-danger">Хостинг</span></dt>
                            <dd>Это результат <strong>автоматической</strong> проверки. Приложение анализирует, кому принадлежит IP-адрес.
                                <ul>
                                    <li><span class="badge bg-success">ISP/Residential</span>: Отлично. IP-адрес "домашний", такие адреса редко блокируются.</li>
                                    <li><span class="badge bg-danger">Хостинг</span>: Внимание. IP-адрес выдан дата-центром или VPN-провайдером. Вероятность блокировки на стриминговых платформах очень высока.</li>
                                </ul>
                            </dd>

                            <dt><span class="badge bg-warning text-dark">DNS ?</span> / <span class="badge bg-success">DNS OK</span></dt>
                            <dd>Это результат <strong>ручной</strong> проверки, которую вы должны провести самостоятельно. Многие стриминговые сервисы определяют ваше реальное местоположение через DNS-запросы. Если они "утекают" (идут мимо вашего VPN-сервера), сервис поймет, что вы используете VPN.
                                <ul>
                                    <li><span class="badge bg-warning text-dark">DNS ?</span>: Статус неизвестен. Проверьте сервер на <a href="https://dnsleaktest.com/" target="_blank">утечки DNS</a>.</li>
                                    <li><span class="badge bg-success">DNS OK</span>: Вы подтвердили, что утечек нет, установив галочку "DNS-тест пройден" в форме редактирования сервера.</li>
                                </ul>
                            </dd>

                            <dt><span class="badge bg-warning text-dark">Стриминг ?</span> / <span class="badge bg-success">Стриминг OK</span></dt>
                            <dd>Это также <strong>ручная</strong> отметка. Она нужна для подтверждения, что конкретный стриминговый сервис работает через этот сервер.
                                 <ul>
                                    <li><span class="badge bg-warning text-dark">Стриминг ?</span>: Статус неизвестен. Вы еще не проверяли работу нужной платформы.</li>
                                    <li><span class="badge bg-success">Стриминг OK</span>: Вы подтвердили, что сервис работает, установив галочку "Стриминг-тест пройден".</li>
                                </ul>
                            </dd>
                        </dl>
                    </div>
                </div>
            </div>

            <div class="accordion-item">
                <h2 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSeven">
                        Управление данными и шифрование
                    </button>
                </h2>
                <div id="collapseSeven" class="accordion-collapse collapse" data-bs-parent="#helpAccordion">
                    <div class="accordion-body">
                        <p>Вся информация о ваших серверах хранится в одном зашифрованном файле, что обеспечивает как безопасность, так и портативность данных.</p>
                        
                        <h5>Как это работает?</h5>
                        <p>
                            Все данные о серверах, которые вы вводите, собираются вместе и преобразуются в единый текстовый блок (в формате JSON). Затем этот блок полностью шифруется и сохраняется в файл с расширением <code>.enc</code>.
                        </p>
                        <p>
                            Можно представить это как подробный чертеж (ваши данные), который разрезали на тысячи мельчайших кусочков и сложили в коробку (файл <code>.enc</code>). Без точной инструкции по сборке (ключа шифрования <code>SECRET_KEY</code>) никто не сможет восстановить исходный чертеж.
                        </p>

                        <h5>Импорт и Экспорт</h5>
                        <p>На странице <strong>"Настройки"</strong> вы можете:</p>
                        <ul>
                            <li><strong>Экспортировать данные:</strong> Скачать текущий зашифрованный файл (<code>.enc</code>). Это полезно для создания резервных копий или переноса данных на другое устройство.</li>
                            <li><strong>Импортировать и прикрепить:</strong> Загрузить ранее экспортированный файл. Приложение начнет работать с ним, и все ваши серверы появятся в списке.</li>
                            <li><strong>Открепить файл:</strong> Прекратить работу с текущим файлом. Список серверов станет пустым, как при первой установке. Сам файл при этом не удаляется.</li>
                        </ul>

                        <h5>Алгоритм шифрования Fernet</h5>
                        <p>
                            Для защиты ваших данных используется <strong>Fernet</strong> — это высокоуровневая система симметричного (с секретным ключом) шифрования из библиотеки <code>cryptography</code>.
                        </p>
                        <p>Ключевые особенности Fernet:</p>
                        <ul>
                            <li><strong>Гарантия подлинности:</strong> Fernet гарантирует, что зашифрованные данные не были изменены или подделаны. Если кто-то попытается изменить хоть один символ в <code>.enc</code> файле, он не сможет быть расшифрован.</li>
                            <li><strong>Надежные алгоритмы:</strong> "Под капотом" Fernet использует стандартные и проверенные временем криптографические алгоритмы: <strong>AES-128</strong> в режиме CBC для шифрования и <strong>HMAC</strong> с SHA256 для аутентификации (проверки подлинности).</li>
                        </ul>
                        <div class="alert alert-info">
                            <strong>Важно:</strong> Вся безопасность системы зависит от секретности вашего ключа <code>SECRET_KEY</code> в файле <code>.env</code>. Никогда и никому его не передавайте.
                        </div>
                    </div>
                </div>
            </div>

            <div class="accordion-item">
                <h2 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseImportExternal">
                        <i class="bi bi-arrow-down-up me-2"></i> Импорт из другой установки
                    </button>
                </h2>
                <div id="collapseImportExternal" class="accordion-collapse collapse" data-bs-parent="#helpAccordion">
                    <div class="accordion-body">
                        <p>Эта функция позволяет перенести данные о серверах из другой установки VPN Server Manager, даже если у неё другой ключ шифрования.</p>
                        
                        <h5>Когда это нужно?</h5>
                        <ul>
                            <li>Вы настроили приложение на другом компьютере и хотите перенести данные на новый</li>
                            <li>У коллеги есть список серверов, и вы хотите добавить его к своему</li>
                            <li>Вы потеряли свой <code>.env</code> файл, но у вас есть резервная копия ключа</li>
                            <li>Вы переустанавливали приложение и создался новый ключ шифрования</li>
                        </ul>

                        <h5>Как это работает?</h5>
                        <ol>
                            <li><strong>Подготовка данных:</strong> На исходном компьютере найдите два файла:
                                <ul>
                                    <li>Файл данных с расширением <code>.enc</code> (обычно в папке <code>data/</code>)</li>
                                    <li>Ключ шифрования из файла <code>.env</code> (строка типа <code>SECRET_KEY=gAAAAABhZ...</code>)</li>
                                </ul>
                            </li>
                            <li><strong>Перенос:</strong> Скопируйте оба элемента на новый компьютер любым удобным способом (флешка, облако, email)</li>
                            <li><strong>Импорт:</strong> На новом компьютере:
                                <ul>
                                    <li>Откройте раздел "Настройки" → "Импорт из другой установки"</li>
                                    <li>Выберите файл <code>.enc</code></li>
                                    <li>Вставьте ключ шифрования в текстовое поле</li>
                                    <li>Нажмите "Импортировать с внешним ключом"</li>
                                </ul>
                            </li>
                        </ol>

                        <h5>Где найти ключ шифрования?</h5>
                        <p>Ключ находится в файле <code>.env</code> в корневой папке приложения:</p>
                        <ul>
                            <li><strong>На macOS:</strong> откройте файл <code>.env</code> в текстовом редакторе</li>
                            <li><strong>В терминале:</strong> выполните <code>cat .env</code> в папке приложения</li>
                            <li><strong>Формат ключа:</strong> строка вида <code>SECRET_KEY=gAAAAABhZ4x2...</code></li>
                        </ul>
                        <p><strong>Скопируйте только значение после знака равенства</strong> (без <code>SECRET_KEY=</code>)</p>

                        <h5>Что происходит при импорте?</h5>
                        <ol>
                            <li>Приложение расшифровывает внешний файл с помощью предоставленного ключа</li>
                            <li>Проверяет корректность данных</li>
                            <li>Зашифровывает данные заново с помощью вашего текущего ключа</li>
                            <li>Сохраняет в вашу систему и делает активными</li>
                        </ol>

                        <div class="alert alert-warning">
                            <i class="bi bi-exclamation-triangle-fill"></i>
                            <strong>Важные замечания:</strong>
                            <ul class="mb-0">
                                <li>Импорт <strong>заменит</strong> ваши текущие данные</li>
                                <li>Создайте резервную копию перед импортом</li>
                                <li>Внешний ключ не сохраняется в системе - он используется только для одноразового импорта</li>
                                <li>После импорта все данные будут зашифрованы вашим текущим ключом</li>
                            </ul>
                        </div>

                        <div class="alert alert-success">
                            <i class="bi bi-lightbulb-fill"></i>
                            <strong>Совет:</strong> Для регулярного обмена данными между установками рекомендуется использовать одинаковый <code>SECRET_KEY</code> на всех устройствах. Тогда можно будет просто копировать <code>.enc</code> файлы без дополнительных действий.
                        </div>
                    </div>
                </div>
            </div>

            <div class="accordion-item">
                <h2 class="accordion-header" id="heading_secret_key">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse_secret_key" aria-expanded="false" aria-controls="collapse_secret_key">
                        <i class="bi bi-key-fill me-2"></i> Что такое SECRET_KEY и где его взять?
                    </button>
                </h2>
                <div id="collapse_secret_key" class="accordion-collapse collapse" aria-labelledby="heading_secret_key" data-bs-parent="#helpAccordion">
                    <div class="card-body">
                        <p><code>SECRET_KEY</code> — это ваш главный пароль для шифрования всех данных в приложении. Он абсолютно необходим для работы.</p>
                        <ul>
                            <li><strong>Где находится:</strong> Ключ хранится в файле <code>.env</code> в корневой папке приложения.</li>
                            <li><strong>Как сгенерировать:</strong> Если вы запускаете приложение в первый раз, вам нужно создать его. Для этого можно использовать Python:
                                <pre><code class="language-python">python3 -c "from cryptography.fernet import Fernet; print(Fernet.generate_key().decode())"</code></pre>
                            </li>
                            <li>Скопируйте полученный длинный код и вставьте его в файл <code>.env</code> в таком виде:
                                <pre><code class="language-bash">SECRET_KEY=ваш_сгенерированный_ключ</code></pre>
                            </li>
                            <li><strong>ВАЖНО:</strong> Никогда и никому не передавайте этот ключ! Потеряв его, вы потеряете доступ ко всем данным. Если вы переносите приложение, обязательно скопируйте файл <code>.env</code> вместе с остальными данными.</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="accordion-item">
                <h2 class="accordion-header" id="heading_transfer">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse_transfer" aria-expanded="false" aria-controls="collapse_transfer">
                        <i class="bi bi-folder-symlink me-2"></i> Структура и перенос приложения на другой компьютер?
                    </button>
                </h2>
                <div id="collapse_transfer" class="accordion-collapse collapse" aria-labelledby="heading_transfer" data-bs-parent="#helpAccordion">
                    <div class="card-body">
                        <p>Перенос приложения со всеми серверами, чеками и настройками требует копирования нескольких ключевых файлов и папок.</p>
                        
                        <div class="alert alert-info">
                            <strong>Важно:</strong> Эта инструкция предназначена для текущей "портативной" версии приложения. В будущем, для версий, установленных через инсталлятор (Windows, macOS), будет предусмотрен специальный механизм экспорта и импорта.
                        </div>

                        <h5>Шаг 1: Что нужно скопировать</h5>
                        <p>Для полного переноса вам нужно скопировать <strong>3 ключевых элемента</strong> из папки проекта:</p>
                        <ol>
                            <li><strong>Файл <code>.env</code></strong> — самый важный файл! В нем содержится ваш уникальный <code>SECRET_KEY</code> для расшифровки данных. <strong>Без него все данные будут утеряны.</strong></li>
                            <li><strong>Папка <code>/data/</code></strong> — здесь хранится основной файл <code>servers.json.enc</code> со всей информацией о ваших серверах.</li>
                            <li><strong>Папка <code>/uploads/</code></strong> — здесь лежат все загруженные вами файлы: иконки серверов и чеки об оплате.</li>
                        </ol>

                        <h5>Шаг 2: Процесс переноса</h5>
                         <ol>
                            <li>На старом компьютере создайте архив всей папки с приложением (например, <code>VPNserverManage.zip</code>). Это самый надежный способ ничего не забыть.</li>
                            <li>Перенесите этот архив на новый компьютер и распакуйте его.</li>
                            <li>На новом компьютере выполните стандартную настройку:
                                <ul>
                                    <li>Создайте и активируйте виртуальное окружение.</li>
                                    <li>Установите зависимости командой <code>pip install -r requirements.txt</code>.</li>
                                </ul>
                            </li>
                            <li>Запустите приложение. Все ваши данные, включая чеки и иконки, должны быть на месте.</li>
                        </ol>
                        
                        <h5 class="mt-4">Структура файлов проекта (для разработчиков)</h5>
                        <p>Для понимания, где что лежит:</p>
                        <ul>
                            <li><code>app.py</code>: Основной файл приложения.</li>
                            <li><code>decrypt_tool.py</code>: Утилита для полной расшифровки данных.</li>
                            <li><code>build_macos.py</code>, <code>build_windows.py</code>: Скрипты для сборки приложения.</li>
                            <li><code>requirements.txt</code>: Список зависимостей Python.</li>
                            <li><code>.env</code>: <strong>Ваш секретный ключ!</strong></li>
                            <li><code>/data/</code>: Здесь хранятся зашифрованные данные серверов (<code>servers.json.enc</code>).</li>
                            <li><code>/uploads/</code>: Загруженные файлы (чеки, иконки).</li>
                            <li><code>/templates/</code>: HTML-шаблоны страниц.</li>
                            <li><code>/static/</code>: Статические файлы (CSS, изображения, иконки <code>.png</code> и <code>.icns</code>).</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="accordion-item">
                <h2 class="accordion-header" id="heading_decrypt_tool">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse_decrypt_tool" aria-expanded="false" aria-controls="collapse_decrypt_tool">
                        <i class="bi bi-unlock-fill me-2"></i> Как посмотреть все пароли сразу (расшифровка)?
                    </button>
                </h2>
                <div id="collapse_decrypt_tool" class="accordion-collapse collapse" aria-labelledby="heading_decrypt_tool" data-bs-parent="#helpAccordion">
                    <div class="card-body">
                        <p>
                            Хотя приложение позволяет просматривать пароли по одному через интерфейс, может возникнуть ситуация, когда вам нужно получить доступ ко всем данным сразу в читаемом виде. Например, для резервного копирования в текстовый файл или для переноса в другую систему.
                        </p>
                        <p>
                            Для этой цели в корневой папке проекта существует специальный инструмент — <code>decrypt_tool.py</code>.
                        </p>
                        
                        <h5>Что он делает?</h5>
                        <p>
                            Этот скрипт использует ваш ключ <code>SECRET_KEY</code> из файла <code>.env</code> для полной расшифровки файла с данными <code>data/servers.json.enc</code>. Он корректно обрабатывает вложенную структуру и расшифровывает все учетные данные: <strong>SSH, панель управления и кабинет хостера</strong>, после чего выводит все в терминал в структурированном виде.
                        </p>

                        <h5>Как использовать?</h5>
                        <p>
                            Вам нужно выполнить одну команду в терминале, находясь в корневой папке проекта:
                        </p>
                        <pre><code class="language-bash">source venv/bin/activate && python3 decrypt_tool.py</code></pre>
                        <p>Эта команда сначала активирует необходимое виртуальное окружение, а затем запускает скрипт для расшифровки.</p>
                        
                        <div class="alert alert-warning">
                            <strong>Внимание:</strong> Выводимые данные (включая все пароли) будут видны в вашем терминале. Убедитесь, что вы делаете это в безопасной обстановке, где никто не сможет увидеть ваш экран.
                        </div>
                    </div>
                </div>
            </div>

            <div class="accordion-item">
                <h2 class="accordion-header" id="heading_macos">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse_macos" aria-expanded="false" aria-controls="collapse_macos">
                        <i class="bi bi-apple me-2"></i> Особенности работы на macOS
                    </button>
                </h2>
                <div id="collapse_macos" class="accordion-collapse collapse" aria-labelledby="heading_macos" data-bs-parent="#helpAccordion">
                    <div class="card-body">
                        <p>В установленной версии приложения для macOS данные хранятся в пользовательской директории для соответствия стандартам безопасности Apple.</p>
                        
                        <h5>Расположение данных</h5>
                        <p>Все данные приложения (файл <code>servers.json.enc</code>, конфигурация, загруженные чеки и иконки) находятся по пути:</p>
                        <p><code>~/Library/Application Support/VPNServerManager/</code></p>
                        <small class="text-muted">Чтобы быстро попасть в эту папку: откройте Finder, нажмите в меню «Переход» (Go), зажмите клавишу <code>Option (⌥)</code> и выберите появившийся пункт «Library». В открывшейся папке далее перейдите в «Application Support», а затем в «VPNServerManager».</small>
                    
                        <h5 class="mt-4">Версия для разработки</h5>
                        <p>Если вы запускаете приложение из исходного кода, все данные хранятся прямо в папке проекта для удобства отладки.</p>
                    </div>
                </div>
            </div>

            <div class="accordion-item">
                <h2 class="accordion-header" id="heading_windows">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse_windows" aria-expanded="false" aria-controls="collapse_windows">
                        <i class="bi bi-windows me-2"></i> Особенности работы на Windows
                    </button>
                </h2>
                <div id="collapse_windows" class="accordion-collapse collapse" aria-labelledby="heading_windows" data-bs-parent="#helpAccordion">
                    <div class="card-body">
                        <p>В установленной версии приложения для Windows (<code>.exe</code>) данные хранятся в системной папке <code>AppData</code>, как и у большинства стандартных приложений.</p>
                        
                        <h5>Расположение данных</h5>
                        <p>Все данные приложения (файл <code>servers.json.enc</code>, конфигурация, загруженные чеки и иконки) находятся по пути:</p>
                        <p><code>%APPDATA%\VPNServerManager\</code></p>
                        <small class="text-muted">Обычно этот путь раскрывается в <code>C:\Users\ВАШЕ_ИМЯ\AppData\Roaming\VPNServerManager</code>. Проще всего вставить <code>%APPDATA%\VPNServerManager</code> в адресную строку Проводника и нажать Enter.</small>
                    
                        <h5 class="mt-4">Версия для разработки</h5>
                        <p>Если вы запускаете приложение из исходного кода, все данные хранятся прямо в папке проекта для удобства отладки.</p>
                    </div>
                </div>
                        </div>

            <div class="accordion-item">
                <h2 class="accordion-header" id="heading_linux">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse_linux" aria-expanded="false" aria-controls="collapse_linux">
                        <i class="bi bi-ubuntu me-2"></i> Особенности работы на Linux
                    </button>
                </h2>
                <div id="collapse_linux" class="accordion-collapse collapse" aria-labelledby="heading_linux" data-bs-parent="#helpAccordion">
                    <div class="card-body">
                        <p>В установленной версии приложения для Linux данные хранятся в директории <code>.local/share</code> в вашей домашней папке, согласно стандартам XDG Base Directory Specification.</p>
                        
                        <h5>Расположение данных</h5>
                        <p>Все данные приложения (файл <code>servers.json.enc</code>, конфигурация, загруженные чеки и иконки) находятся по пути:</p>
                        <p><code>~/.local/share/VPNServerManager/</code></p>
                        <small class="text-muted">Папка <code>.local</code> является скрытой. Чтобы увидеть её в файловом менеджере, включите отображение скрытых файлов (обычно по нажатию <code>Ctrl+H</code>).</small>
                    
                        <h5 class="mt-4">Версия для разработки</h5>
                        <p>Если вы запускаете приложение из исходного кода, все данные хранятся прямо в папке проекта для удобства отладки.</p>
                    </div>
                </div>
            </div>

            <div class="accordion-item">
                <h2 class="accordion-header" id="heading_icons">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse_icons" aria-expanded="false" aria-controls="collapse_icons">
                        <i class="bi bi-image me-2"></i> Создание и настройка иконок приложения
                    </button>
                </h2>
                <div id="collapse_icons" class="accordion-collapse collapse" aria-labelledby="heading_icons" data-bs-parent="#helpAccordion">
                    <div class="card-body">
                        <p>Приложение поддерживает кастомные иконки для каждой операционной системы. Это позволяет создать единый визуальный стиль на всех платформах.</p>
                        
                        <h5>Требования к исходной иконке</h5>
                        <div class="alert alert-info">
                            <strong>Рекомендуется:</strong> Используйте PNG файл размером <strong>1024x1024 пикселей</strong> с прозрачным фоном. Это обеспечит наилучшее качество на всех устройствах, включая Retina-дисплеи.
                        </div>
                        <ul>
                            <li><strong>Формат:</strong> PNG с альфа-каналом (прозрачность)</li>
                            <li><strong>Размер:</strong> 1024x1024 пикселей (квадрат)</li>
                            <li><strong>Цветовая модель:</strong> RGB</li>
                            <li><strong>Расположение:</strong> <code>static/images/icon.png</code></li>
                        </ul>

                        <h5>Автоматическое создание иконок</h5>
                        <p>При использовании скриптов сборки (<code>build_macos.py</code> или <code>build_windows.py</code>) иконки создаются автоматически из исходного PNG файла:</p>
                        <ul>
                            <li><strong>macOS:</strong> Создается файл <code>static/images/icon.icns</code> со всеми необходимыми размерами</li>
                            <li><strong>Windows:</strong> Создается файл <code>static/favicon.ico</code> с множественными размерами</li>
                        </ul>

                        <h5>Ручное создание иконок</h5>
                        <p>Если вы хотите создать иконки вручную или скрипты сборки не работают:</p>
                        
                        <h6>Для macOS (.icns)</h6>
                        <p>Создайте временную папку и нарежьте иконку на нужные размеры:</p>
                        <pre><code class="language-bash"># Создайте временную папку
mkdir -p static/images/tmp.iconset

# Создайте иконки разных размеров
sips -z 16 16 static/images/icon.png --out static/images/tmp.iconset/icon_16x16.png
sips -z 32 32 static/images/icon.png --out static/images/tmp.iconset/icon_16x16@2x.png
sips -z 32 32 static/images/icon.png --out static/images/tmp.iconset/icon_32x32.png
sips -z 64 64 static/images/icon.png --out static/images/tmp.iconset/icon_32x32@2x.png
sips -z 128 128 static/images/icon.png --out static/images/tmp.iconset/icon_128x128.png
sips -z 256 256 static/images/icon.png --out static/images/tmp.iconset/icon_128x128@2x.png
sips -z 256 256 static/images/icon.png --out static/images/tmp.iconset/icon_256x256.png
sips -z 512 512 static/images/icon.png --out static/images/tmp.iconset/icon_256x256@2x.png
sips -z 512 512 static/images/icon.png --out static/images/tmp.iconset/icon_512x512.png
cp static/images/icon.png static/images/tmp.iconset/icon_512x512@2x.png

# Создайте .icns файл
iconutil -c icns static/images/tmp.iconset

# Переместите результат и очистите временные файлы
mv static/images/tmp.icns static/images/icon.icns
rm -rf static/images/tmp.iconset</code></pre>

                        <h6>Для Windows (.ico)</h6>
                        <p>Используйте Python с библиотекой Pillow для создания .ico файла:</p>
                        <pre><code class="language-bash"># Установите Pillow, если не установлена
pip install Pillow

# Создайте .ico файл
python3 -c "
from PIL import Image
import os

if os.path.exists('static/images/icon.png'):
    img = Image.open('static/images/icon.png')
    img.save('static/favicon.ico', format='ICO', sizes=[(16,16), (32,32), (48,48), (64,64), (128,128), (256,256)])
    print('Создан .ico файл: static/favicon.ico')
else:
    print('PNG файл не найден: static/images/icon.png')
"</code></pre>

                        <h5>Замена иконки в уже собранном приложении</h5>
                        <p>Если вы хотите заменить иконку в уже готовом приложении без пересборки:</p>
                        
                        <h6>macOS</h6>
                        <ol>
                            <li>Найдите приложение в папке Applications</li>
                            <li>Кликните правой кнопкой мыши → "Get Info" (Свойства)</li>
                            <li>Перетащите новую иконку на маленькую иконку в левом верхнем углу окна</li>
                            <li>Или замените файл <code>YourApp.app/Contents/Resources/icon.icns</code> напрямую</li>
                        </ol>

                        <h6>Windows</h6>
                        <ol>
                            <li>Найдите .exe файл приложения</li>
                            <li>Кликните правой кнопкой мыши → "Properties" → "Change Icon"</li>
                            <li>Или используйте специальные утилиты для замены иконок в .exe файлах (например, Resource Hacker)</li>
                        </ol>

                        <h5>Советы по оптимизации</h5>
                        <ul>
                            <li><strong>Простота:</strong> Иконки должны быть читаемы в малых размерах (16x16). Избегайте мелких деталей.</li>
                            <li><strong>Контраст:</strong> Используйте высокий контраст между элементами иконки и фоном.</li>
                            <li><strong>Тестирование:</strong> Проверьте как иконка выглядит на разных фонах (светлом/темном).</li>
                            <li><strong>Формат:</strong> Всегда используйте PNG с прозрачностью как исходник - это обеспечит лучшую совместимость.</li>
                        </ul>

                        <div class="alert alert-warning">
                            <strong>Важно:</strong> После замены иконки может потребоваться перезагрузка системы или очистка кэша иконок, чтобы изменения стали видны в файловом менеджере.
                        </div>

                        <h5>Устранение проблем с иконками</h5>
                        <p>Если иконки не отображаются или приложение собирается с дефектными иконками:</p>
                        
                        <h6>Проблема: Иконка не отображается в собранном приложении</h6>
                        <ul>
                            <li><strong>Проверьте размер файла:</strong> Убедитесь, что <code>static/images/icon.icns</code> имеет размер больше 1KB. Если файл всего несколько байт, он поврежден.</li>
                            <li><strong>Пересоздайте иконки:</strong> Удалите <code>static/images/icon.icns</code> и <code>static/favicon.ico</code>, затем запустите сборку снова.</li>
                            <li><strong>Проверьте путь в build_macos.py:</strong> Убедитесь, что путь <code>ICON_FILE</code> правильно указывает на <code>static/images/icon.icns</code></li>
                        </ul>

                        <h6>Проблема: Ошибка при автоматическом создании иконок</h6>
                        <ul>
                            <li><strong>macOS:</strong> Убедитесь, что утилиты <code>sips</code> и <code>iconutil</code> доступны в системе</li>
                            <li><strong>Windows:</strong> Установите библиотеку Pillow: <code>pip install Pillow</code></li>
                            <li><strong>Права доступа:</strong> Убедитесь, что у приложения есть права на запись в папку <code>static/images/</code></li>
                        </ul>

                        <h6>Проблема: Иконка размыта или низкого качества</h6>
                        <ul>
                            <li><strong>Увеличьте разрешение исходника:</strong> Используйте PNG размером не менее 1024x1024 пикселей</li>
                            <li><strong>Проверьте качество PNG:</strong> Убедитесь, что исходный файл не сжат с потерями</li>
                            <li><strong>Пересоздайте иконки:</strong> Удалите старые иконки и пересоздайте их из нового PNG</li>
                        </ul>

                        <h6>Диагностика проблем</h6>
                        <p>Для диагностики проблем с иконками выполните следующие команды:</p>
                        <pre><code class="language-bash"># Проверьте размер и тип файлов иконок
ls -la static/images/icon.icns static/favicon.ico
file static/images/icon.icns static/favicon.ico

# Проверьте исходный PNG
file static/images/icon.png</code></pre>

                        <div class="alert alert-info">
                            <strong>Совет:</strong> Если проблемы с иконками повторяются, создайте резервную копию рабочей иконки после успешной сборки. Это поможет быстро восстановить функциональность в случае проблем.
                        </div>
                    </div>
                </div>
            </div>

            <div class="accordion-item">
                <h2 class="accordion-header" id="heading_structure">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse_structure" aria-expanded="false" aria-controls="collapse_structure">
                        <i class="bi bi-diagram-3 me-2"></i> Структура проекта и алгоритм работы
                    </button>
                </h2>
                <div id="collapse_structure" class="accordion-collapse collapse" aria-labelledby="heading_structure" data-bs-parent="#helpAccordion">
                    <div class="card-body">
                        <h5>Дерево Проекта</h5>
<pre><code class="language-bash">
VPNserverManage/
│
├── app.py
├── build_macos.py
├── requirements.txt
├── config.json
│
├── data/
│   ├── servers.json.enc
│   └── hints.json
│
├── static/
│   └── ...
│
├── templates/
│   └── ...
│
└── venv/
</code></pre>
                        <h5>Описание Файлов и Директорий</h5>
                        <ul>
                            <li><strong><code>app.py</code></strong>: Сердце приложения. Содержит веб-сервер Flask, логику шифрования и интеграцию с PyWebView для создания окна.</li>
                            <li><strong><code>build_macos.py</code></strong>: Скрипт для сборки приложения в <code>.app</code> для macOS с помощью PyInstaller.</li>
                            <li><strong><code>requirements.txt</code></strong>: Список всех библиотек Python, необходимых для работы.</li>
                            <li><strong><code>config.json</code></strong>: Файл настроек, хранит информацию о версии и URL-адреса внешних сервисов.</li>
                            <li><strong><code>data/servers.json.enc</code></strong>: Самый важный файл. Это <strong>зашифрованный</strong> JSON-файл, содержащий всю информацию о серверах.</li>
                            <li><strong><code>static/</code></strong> и <strong><code>templates/</code></strong>: Папки со статическими ресурсами (CSS, картинки) и HTML-шаблонами для веб-интерфейса.</li>
                        </ul>

                        <h5>Алгоритм Работы Программы</h5>
                        <ol>
                            <li><strong>Запуск</strong>: `app.py` запускает веб-сервер Flask в фоновом потоке и создает нативное окно с помощью PyWebView.</li>
                            <li><strong>Отображение</strong>: В окне загружается веб-страница. Flask расшифровывает данные из <code>servers.json.enc</code> и показывает их.</li>
                            <li><strong>Взаимодействие</strong>: Все действия пользователя обрабатываются Flask, который изменяет данные и снова шифрует их.</li>
                            <li><strong>Завершение</strong>: При закрытии окна PyWebView отправляет команду на выключение сервера Flask, который корректно завершает работу и освобождает порт.</li>
                        </ol>
                    </div>
                </div>
            </div>

            <div class="accordion-item">
                <h2 class="accordion-header" id="heading_pin">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse_pin" aria-expanded="false" aria-controls="collapse_pin">
                        <i class="bi bi-shield-lock me-2"></i> PIN-система защиты
                    </button>
                </h2>
                <div id="collapse_pin" class="accordion-collapse collapse" aria-labelledby="heading_pin" data-bs-parent="#helpAccordion">
                    <div class="card-body">
                        <p>Приложение защищено PIN-кодом для дополнительной безопасности. Это обеспечивает защиту от несанкционированного доступа к вашим данным.</p>
                        
                        <h5>Первый запуск</h5>
                        <p>При первом запуске приложения вы увидите экран "Доступ ограничен". У вас есть два варианта:</p>
                        <ul>
                            <li><strong>Создать новый PIN:</strong> Нажмите "Первый запуск" → "Создать новый PIN-код". Это создаст новый PIN и сбросит все данные.</li>
                            <li><strong>Импортировать архив:</strong> Нажмите "Первый запуск" → "Импортировать архив". Это позволит восстановить данные из ранее созданного архива.</li>
                        </ul>

                        <h5>Вход в приложение</h5>
                        <p>После настройки PIN-кода для входа в приложение используйте один из способов:</p>
                        <ul>
                            <li><strong>Двойной клик по имени разработчика:</strong> Внизу страницы найдите имя разработчика в футере и дважды кликните по нему.</li>
                            <li><strong>Через настройки:</strong> Если вы уже вошли в систему, можете изменить PIN в разделе "Настройки".</li>
                        </ul>

                        <h5>Безопасность PIN-кода</h5>
                        <ul>
                            <li><strong>Минимальная длина:</strong> PIN должен содержать минимум 4 символа</li>
                            <li><strong>Защита от перебора:</strong> После 2 неудачных попыток вход блокируется на 30 секунд</li>
                            <li><strong>Автоматический счетчик:</strong> При блокировке на экране отображается обратный отсчет времени</li>
                            <li><strong>Хранение:</strong> PIN хранится в зашифрованном виде в файле конфигурации</li>
                        </ul>

                        <h5>Экспорт и импорт с PIN</h5>
                        <p>При использовании функции "Полный экспорт" PIN-код автоматически включается в архив:</p>
                        <ul>
                            <li><strong>Экспорт:</strong> В созданный ZIP-архив добавляется файл <code>PIN.txt</code> с вашим PIN-кодом</li>
                            <li><strong>Импорт:</strong> При импорте архива PIN автоматически извлекается и устанавливается</li>
                            <li><strong>Показ PIN:</strong> При импорте PIN отображается в отдельном окне для записи</li>
                        </ul>

                        <h5>Смена PIN-кода</h5>
                        <p>Для смены PIN-кода:</p>
                        <ol>
                            <li>Войдите в приложение</li>
                            <li>Перейдите в "Настройки"</li>
                            <li>Найдите раздел "PIN-код"</li>
                            <li>Введите старый PIN и новый PIN дважды</li>
                            <li>Нажмите "Сменить PIN"</li>
                        </ol>

                        <h5>Выход из системы</h5>
                        <p>Для выхода из системы нажмите кнопку "Выход" в верхней панели навигации. После выхода потребуется повторный ввод PIN-кода для доступа к данным.</p>

                        <div class="alert alert-warning">
                            <i class="bi bi-exclamation-triangle-fill"></i>
                            <strong>Важно:</strong>
                            <ul class="mb-0">
                                <li>Запишите PIN-код в надежном месте - без него вы не сможете получить доступ к данным</li>
                                <li>При создании нового PIN все существующие данные будут удалены</li>
                                <li>PIN-код не восстанавливается - если вы его забудете, потребуется создавать новый</li>
                            </ul>
                        </div>

                        <div class="alert alert-info">
                            <i class="bi bi-lightbulb-fill"></i>
                            <strong>Совет:</strong> Для максимальной безопасности используйте PIN-код длиной 6-8 символов, содержащий цифры и буквы.
                        </div>
                    </div>
                </div>
            </div>

            <div class="accordion-item">
                <h2 class="accordion-header" id="heading_dev">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse_dev" aria-expanded="false" aria-controls="collapse_dev">
                        <i class="bi bi-code-slash me-2"></i> Для разработчиков
                    </button>
                </h2>
                <div id="collapse_dev" class="accordion-collapse collapse" aria-labelledby="heading_dev" data-bs-parent="#helpAccordion">
                    <div class="card-body">
                        <h5>Ошибка `ModuleNotFoundError`</h5>
                        <p>Если при запуске приложения из исходного кода (<code>python3 app.py</code>) вы видите ошибку <code>ModuleNotFoundError: No module named 'имя_модуля'</code>, это означает, что в вашем окружении отсутствует необходимая библиотека.</p>
                        <p>Это происходит, когда в проект добавляется новая функциональность (например, как недавно был добавлен `pywebview`).</p>
                        <h6>Решение</h6>
                        <p>Чтобы установить или обновить все зависимости, выполните в терминале следующую команду, находясь в папке проекта:</p>
                        <pre><code class="language-bash">python3 -m pip install -r requirements.txt</code></pre>
                        <p>Эта команда прочитает файл <code>requirements.txt</code> и установит точные версии всех библиотек, необходимых для корректной работы.</p>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>
{% endblock %} 