{% extends "layout.html" %}

{% block title %}{{ _('Шпаргалка по командам') }}{% endblock %}

{% block content %}
<div class="container mt-4">
    <h1 class="mb-4">{{ _('Краткая шпаргалка по диагностике сервера (Debian/Ubuntu)') }}</h1>
    <p class="lead">{{ _('Этот раздел объединяет наиболее полезные команды для быстрой оценки состояния сервера.') }}</p>
    
    <div class="card mb-4">
        <div class="card-header">
            <h5 class="mb-0">{{ _('Быстрая сводка') }}</h5>
        </div>
        <div class="card-body">
            <div class="position-relative">
                <pre><code class="language-bash">echo "=== Система ===" && cat /etc/os-release | head -2 && \
echo "=== Процессор ===" && cat /proc/cpuinfo | grep "model name" | head -1 && \
echo "=== Память ===" && cat /proc/meminfo | grep MemTotal</code></pre>
                <button class="btn btn-sm btn-outline-secondary copy-btn" style="position: absolute; top: 0.5rem; right: 0.5rem;">
                    <i class="bi bi-clipboard"></i>
                </button>
            </div>
        </div>
    </div>

    <div class="card mb-4">
        <div class="card-header">
            <h5 class="mb-0">{{ _('Установленное ПО') }}</h5>
        </div>
        <ul class="list-group list-group-flush">
            <li class="list-group-item">
                <p class="mb-1"><strong>{{ _('Показать все установленные пакеты:') }}</strong></p>
                <div class="position-relative">
                    <pre><code class="language-bash">dpkg -l | grep ii | cat</code></pre>
                    <button class="btn btn-sm btn-outline-secondary copy-btn" style="position: absolute; top: 0.5rem; right: 0.5rem;"><i class="bi bi-clipboard"></i></button>
                </div>
            </li>
            <li class="list-group-item">
                <p class="mb-1"><strong>{{ _('Найти конкретный пакет') }}</strong> ({{ _('замените') }} `nginx`):</p>
                <div class="position-relative">
                    <pre><code class="language-bash">dpkg -l | grep nginx</code></pre>
                    <button class="btn btn-sm btn-outline-secondary copy-btn" style="position: absolute; top: 0.5rem; right: 0.5rem;"><i class="bi bi-clipboard"></i></button>
                </div>
            </li>
            <li class="list-group-item">
                <p class="mb-1"><strong>{{ _('Показать файлы, установленные пакетом') }}</strong> ({{ _('замените') }} `nginx`):</p>
                <div class="position-relative">
                    <pre><code class="language-bash">dpkg -L nginx | cat</code></pre>
                    <button class="btn btn-sm btn-outline-secondary copy-btn" style="position: absolute; top: 0.5rem; right: 0.5rem;"><i class="bi bi-clipboard"></i></button>
                </div>
            </li>
        </ul>
    </div>

    <div class="card mb-4">
        <div class="card-header">
            <h5 class="mb-0">{{ _('Ключевые утилиты') }}</h5>
        </div>
        <ul class="list-group list-group-flush">
            <li class="list-group-item">
                <p class="mb-1"><strong>{{ _('Информация о ядре и системе') }}</strong></p>
                <div class="position-relative">
                    <pre><code class="language-bash">uname -a</code></pre>
                    <button class="btn btn-sm btn-outline-secondary copy-btn" style="position: absolute; top: 0.5rem; right: 0.5rem;">
                        <i class="bi bi-clipboard"></i>
                    </button>
                </div>
            </li>
            <li class="list-group-item">
                <p class="mb-1"><strong>{{ _('Информация о процессоре') }}</strong></p>
                <div class="position-relative">
                    <pre><code class="language-bash">lscpu | cat</code></pre>
                    <button class="btn btn-sm btn-outline-secondary copy-btn" style="position: absolute; top: 0.5rem; right: 0.5rem;">
                        <i class="bi bi-clipboard"></i>
                    </button>
                </div>
            </li>
            <li class="list-group-item">
                <p class="mb-1"><strong>{{ _('Использование оперативной памяти') }}</strong></p>
                <div class="position-relative">
                    <pre><code class="language-bash">free -h</code></pre>
                    <button class="btn btn-sm btn-outline-secondary copy-btn" style="position: absolute; top: 0.5rem; right: 0.5rem;">
                        <i class="bi bi-clipboard"></i>
                    </button>
                </div>
            </li>
            <li class="list-group-item">
                <p class="mb-1"><strong>{{ _('Использование дискового пространства') }}</strong></p>
                <div class="position-relative">
                    <pre><code class="language-bash">df -h</code></pre>
                    <button class="btn btn-sm btn-outline-secondary copy-btn" style="position: absolute; top: 0.5rem; right: 0.5rem;">
                        <i class="bi bi-clipboard"></i>
                    </button>
                </div>
            </li>
            <li class="list-group-item">
                <p class="mb-1"><strong>{{ _('Просмотр сетевых интерфейсов') }}</strong></p>
                <div class="position-relative">
                    <pre><code class="language-bash">ip a</code></pre>
                    <button class="btn btn-sm btn-outline-secondary copy-btn" style="position: absolute; top: 0.5rem; right: 0.5rem;">
                        <i class="bi bi-clipboard"></i>
                    </button>
                </div>
            </li>
            <li class="list-group-item">
                <p class="mb-1"><strong>{{ _('Просмотр активных сетевых портов') }}</strong></p>
                <div class="position-relative">
                    <pre><code class="language-bash">ss -tulnp | cat</code></pre>
                    <button class="btn btn-sm btn-outline-secondary copy-btn" style="position: absolute; top: 0.5rem; right: 0.5rem;">
                        <i class="bi bi-clipboard"></i>
                    </button>
                </div>
            </li>
            <li class="list-group-item">
                <p class="mb-1"><strong>{{ _('Кто сейчас в системе') }}</strong></p>
                <div class="position-relative">
                    <pre><code class="language-bash">w</code></pre>
                    <button class="btn btn-sm btn-outline-secondary copy-btn" style="position: absolute; top: 0.5rem; right: 0.5rem;">
                        <i class="bi bi-clipboard"></i>
                    </button>
                </div>
            </li>
            <li class="list-group-item">
                <p class="mb-1"><strong>{{ _('Системный журнал в реальном времени') }}</strong></p>
                <div class="position-relative">
                    <pre><code class="language-bash">tail -f /var/log/syslog</code></pre>
                    <button class="btn btn-sm btn-outline-secondary copy-btn" style="position: absolute; top: 0.5rem; right: 0.5rem;">
                        <i class="bi bi-clipboard"></i>
                    </button>
                </div>
            </li>
        </ul>
    </div>

    <div class="card mb-4">
        <div class="card-header">
            <h5 class="mb-0">{{ _('Подробнее о `df` (использование дискового пространства)') }}</h5>
        </div>
        <ul class="list-group list-group-flush">
            <li class="list-group-item">
                <p class="mb-1"><strong>{{ _('Показать тип файловой системы') }}</strong> ({{ _('например') }}, ext4, xfs)</p>
                <div class="position-relative">
                    <pre><code class="language-bash">df -hT</code></pre>
                    <button class="btn btn-sm btn-outline-secondary copy-btn" style="position: absolute; top: 0.5rem; right: 0.5rem;">
                        <i class="bi bi-clipboard"></i>
                    </button>
                </div>
            </li>
             <li class="list-group-item">
                <p class="mb-1"><strong>{{ _('Показать итоговую строку с суммой по всем разделам') }}</strong></p>
                <div class="position-relative">
                    <pre><code class="language-bash">df -h --total</code></pre>
                    <button class="btn btn-sm btn-outline-secondary copy-btn" style="position: absolute; top: 0.5rem; right: 0.5rem;">
                        <i class="bi bi-clipboard"></i>
                    </button>
                </div>
            </li>
        </ul>
    </div>

    <div class="card mb-4">
        <div class="card-header">
            <h5 class="mb-0">{{ _('Основы безопасности') }}</h5>
        </div>
        <ul class="list-group list-group-flush">
            <li class="list-group-item">
                <p class="mb-1"><strong>{{ _('Управление файрволом (ufw)') }}</strong></p>
                <div class="position-relative my-2">
                    <small class="text-muted">{{ _('Проверить статус и правила:') }}</small>
                    <pre><code class="language-bash">sudo ufw status verbose</code></pre>
                    <button class="btn btn-sm btn-outline-secondary copy-btn" style="position: absolute; top: 0.5rem; right: 0.5rem;"><i class="bi bi-clipboard"></i></button>
                </div>
                <div class="position-relative my-2">
                    <small class="text-muted">{{ _('Разрешить стандартный порт SSH (22):') }}</small>
                    <pre><code class="language-bash">sudo ufw allow ssh</code></pre>
                    <button class="btn btn-sm btn-outline-secondary copy-btn" style="position: absolute; top: 0.5rem; right: 0.5rem;"><i class="bi bi-clipboard"></i></button>
                </div>
                <div class="position-relative my-2">
                    <small class="text-muted">{{ _('Пример: разрешить нестандартный порт SSH (например, 2222):') }}</small>
                    <pre><code class="language-bash">sudo ufw allow 2222/tcp</code></pre>
                    <button class="btn btn-sm btn-outline-secondary copy-btn" style="position: absolute; top: 0.5rem; right: 0.5rem;"><i class="bi bi-clipboard"></i></button>
                </div>
                 <div class="position-relative my-2">
                    <small class="text-muted">{{ _('Пример: разрешить порт для веб-сервера (HTTPS):') }}</small>
                    <pre><code class="language-bash">sudo ufw allow 443/tcp</code></pre>
                    <button class="btn btn-sm btn-outline-secondary copy-btn" style="position: absolute; top: 0.5rem; right: 0.5rem;"><i class="bi bi-clipboard"></i></button>
                </div>
                 <div class="position-relative my-2">
                    <small class="text-muted">{{ _('Пример: удалить правило:') }}</small>
                    <pre><code class="language-bash">sudo ufw delete allow 443/tcp</code></pre>
                    <button class="btn btn-sm btn-outline-secondary copy-btn" style="position: absolute; top: 0.5rem; right: 0.5rem;"><i class="bi bi-clipboard"></i></button>
                </div>
            </li>
            <li class="list-group-item">
                <p class="mb-1"><strong>{{ _('Проверка Fail2Ban') }}</strong></p>
                <div class="position-relative my-2">
                    <small class="text-muted">{{ _('Статус службы Fail2Ban:') }}</small>
                    <pre><code class="language-bash">sudo systemctl status fail2ban</code></pre>
                    <button class="btn btn-sm btn-outline-secondary copy-btn" style="position: absolute; top: 0.5rem; right: 0.5rem;"><i class="bi bi-clipboard"></i></button>
                </div>
                <div class="position-relative my-2">
                    <small class="text-muted">{{ _('Статус защиты SSH и список забаненных IP:') }}</small>
                    <pre><code class="language-bash">sudo fail2ban-client status sshd</code></pre>
                    <button class="btn btn-sm btn-outline-secondary copy-btn" style="position: absolute; top: 0.5rem; right: 0.5rem;"><i class="bi bi-clipboard"></i></button>
                </div>
                <div class="position-relative my-2">
                    <small class="text-muted">{{ _('Разбанить IP-адрес (замените 1.2.3.4):') }}</small>
                    <pre><code class="language-bash">sudo fail2ban-client set sshd unbanip 1.2.3.4</code></pre>
                    <button class="btn btn-sm btn-outline-secondary copy-btn" style="position: absolute; top: 0.5rem; right: 0.5rem;"><i class="bi bi-clipboard"></i></button>
                </div>
            </li>
            <li class="list-group-item">
                <p class="mb-1"><strong>{{ _('Аудит и мониторинг') }}</strong></p>
                 <div class="position-relative my-2">
                    <small class="text-muted">{{ _('Показать последних вошедших пользователей:') }}</small>
                    <pre><code class="language-bash">last | cat</code></pre>
                    <button class="btn btn-sm btn-outline-secondary copy-btn" style="position: absolute; top: 0.5rem; right: 0.5rem;"><i class="bi bi-clipboard"></i></button>
                </div>
                <div class="position-relative my-2">
                    <small class="text-muted">{{ _('Показать неудачные попытки входа (требует root):') }}</small>
                    <pre><code class="language-bash">sudo lastb | cat</code></pre>
                    <button class="btn btn-sm btn-outline-secondary copy-btn" style="position: absolute; top: 0.5rem; right: 0.5rem;"><i class="bi bi-clipboard"></i></button>
                </div>
            </li>
        </ul>
    </div>

    <div class="card mb-4">
        <div class="card-header">
            <h5 class="mb-0">{{ _('Управление процессами') }}</h5>
        </div>
        <ul class="list-group list-group-flush">
            <li class="list-group-item">
                <p class="mb-1"><strong>{{ _('Показать все запущенные процессы') }}</strong></p>
                <div class="position-relative my-2">
                    <pre><code class="language-bash">ps aux | cat</code></pre>
                    <button class="btn btn-sm btn-outline-secondary copy-btn" style="position: absolute; top: 0.5rem; right: 0.5rem;"><i class="bi bi-clipboard"></i></button>
                </div>
            </li>
            <li class="list-group-item">
                <p class="mb-1"><strong>{{ _('Интерактивный монитор процессов') }}</strong> ({{ _('htop более удобен, если установлен') }})</p>
                <div class="position-relative my-2">
                    <pre><code class="language-bash">top</code></pre>
                    <button class="btn btn-sm btn-outline-secondary copy-btn" style="position: absolute; top: 0.5rem; right: 0.5rem;"><i class="bi bi-clipboard"></i></button>
                </div>
            </li>
            <li class="list-group-item">
                <p class="mb-1"><strong>{{ _('Найти процесс по имени') }}</strong> ({{ _('замените') }} `nginx`)</p>
                <div class="position-relative my-2">
                    <pre><code class="language-bash">ps aux | grep nginx</code></pre>
                    <button class="btn btn-sm btn-outline-secondary copy-btn" style="position: absolute; top: 0.5rem; right: 0.5rem;"><i class="bi bi-clipboard"></i></button>
                </div>
            </li>
        </ul>
    </div>

     <div class="card mb-4">
        <div class="card-header">
            <h5 class="mb-0">{{ _('Управление службами (systemd)') }}</h5>
        </div>
        <ul class="list-group list-group-flush">
            <li class="list-group-item">
                 <p class="mb-1"><strong>{{ _('Проверить статус службы') }}</strong> ({{ _('замените') }} `nginx`)</p>
                 <div class="position-relative">
                    <pre><code class="language-bash">sudo systemctl status nginx</code></pre>
                    <button class="btn btn-sm btn-outline-secondary copy-btn" style="position: absolute; top: 0.5rem; right: 0.5rem;"><i class="bi bi-clipboard"></i></button>
                </div>
            </li>
             <li class="list-group-item">
                 <p class="mb-1"><strong>{{ _('Перезапустить службу:') }}</strong></p>
                 <div class="position-relative">
                    <pre><code class="language-bash">sudo systemctl restart nginx</code></pre>
                    <button class="btn btn-sm btn-outline-secondary copy-btn" style="position: absolute; top: 0.5rem; right: 0.5rem;"><i class="bi bi-clipboard"></i></button>
                </div>
            </li>
             <li class="list-group-item">
                 <p class="mb-1"><strong>{{ _('Включить автозапуск службы:') }}</strong></p>
                 <div class="position-relative">
                    <pre><code class="language-bash">sudo systemctl enable nginx</code></pre>
                    <button class="btn btn-sm btn-outline-secondary copy-btn" style="position: absolute; top: 0.5rem; right: 0.5rem;"><i class="bi bi-clipboard"></i></button>
                </div>
            </li>
             <li class="list-group-item">
                 <p class="mb-1"><strong>{{ _('Выключить автозапуск службы:') }}</strong></p>
                 <div class="position-relative">
                    <pre><code class="language-bash">sudo systemctl disable nginx</code></pre>
                    <button class="btn btn-sm btn-outline-secondary copy-btn" style="position: absolute; top: 0.5rem; right: 0.5rem;"><i class="bi bi-clipboard"></i></button>
                </div>
            </li>
        </ul>
    </div>

     <div class="card mb-4">
        <div class="card-header">
            <h5 class="mb-0">{{ _('Управление пакетами (apt)') }}</h5>
        </div>
        <ul class="list-group list-group-flush">
            <li class="list-group-item">
                 <p class="mb-1"><strong>{{ _('Обновить список пакетов:') }}</strong></p>
                 <div class="position-relative">
                    <pre><code class="language-bash">sudo apt update</code></pre>
                    <button class="btn btn-sm btn-outline-secondary copy-btn" style="position: absolute; top: 0.5rem; right: 0.5rem;"><i class="bi bi-clipboard"></i></button>
                </div>
            </li>
             <li class="list-group-item">
                 <p class="mb-1"><strong>{{ _('Обновить установленные пакеты:') }}</strong></p>
                 <div class="position-relative">
                    <pre><code class="language-bash">sudo apt upgrade</code></pre>
                    <button class="btn btn-sm btn-outline-secondary copy-btn" style="position: absolute; top: 0.5rem; right: 0.5rem;"><i class="bi bi-clipboard"></i></button>
                </div>
            </li>
             <li class="list-group-item">
                 <p class="mb-1"><strong>{{ _('Установить пакет') }}</strong> ({{ _('замените') }} `htop`):</p>
                 <div class="position-relative">
                    <pre><code class="language-bash">sudo apt install htop</code></pre>
                    <button class="btn btn-sm btn-outline-secondary copy-btn" style="position: absolute; top: 0.5rem; right: 0.5rem;"><i class="bi bi-clipboard"></i></button>
                </div>
            </li>
             <li class="list-group-item">
                 <p class="mb-1"><strong>{{ _('Удалить пакет:') }}</strong></p>
                 <div class="position-relative">
                    <pre><code class="language-bash">sudo apt remove htop</code></pre>
                    <button class="btn btn-sm btn-outline-secondary copy-btn" style="position: absolute; top: 0.5rem; right: 0.5rem;"><i class="bi bi-clipboard"></i></button>
                </div>
            </li>
        </ul>
    </div>

</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', () => {
    const copyButtons = document.querySelectorAll('.copy-btn');
    copyButtons.forEach(button => {
        button.addEventListener('click', (e) => {
            const pre = e.currentTarget.closest('.position-relative').querySelector('pre');
            const code = pre.querySelector('code');
            const command = code.innerText;

            navigator.clipboard.writeText(command).then(() => {
                const originalHtml = button.innerHTML;
                button.innerHTML = '<i class="bi bi-check-lg"></i> {{ _("Скопировано!") }}';
                button.classList.remove('btn-outline-secondary');
                button.classList.add('btn-success');
                
                setTimeout(() => {
                    button.innerHTML = originalHtml;
                    button.classList.remove('btn-success');
                    button.classList.add('btn-outline-secondary');
                }, 2000);
            }).catch(err => {
                console.error('{{ _("Не удалось скопировать текст: ") }}', err);
                alert('{{ _("Ошибка при копировании") }}');
            });
        });
    });
});
</script>
{% endblock %} 