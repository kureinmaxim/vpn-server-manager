# –°–∏—Å—Ç–µ–º–∞ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è SECRET_KEY –≤ VPN Server Manager

## üîê –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∫–ª—é—á–∞

SECRET_KEY - —ç—Ç–æ –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π –∫–ª—é—á, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è –≤—Å–µ—Ö —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏:

- **–ü–∞—Ä–æ–ª–∏ SSH** —Å–µ—Ä–≤–µ—Ä–æ–≤
- **–î–∞–Ω–Ω—ã–µ –ø–∞–Ω–µ–ª–µ–π —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è** (–ª–æ–≥–∏–Ω—ã, –ø–∞—Ä–æ–ª–∏)
- **–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ö–æ—Å—Ç–∏–Ω–≥–∞—Ö** (—É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)
- **–í—Å–µ –¥–∞–Ω–Ω—ã–µ —Å–µ—Ä–≤–µ—Ä–æ–≤** –≤ —Ñ–∞–π–ª–µ `servers.json.enc`

## üé≤ –°–æ–∑–¥–∞–Ω–∏–µ –∫–ª—é—á–∞

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è
```bash
python3 generate_key.py
```

### –†—É—á–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ
```python
from cryptography.fernet import Fernet
key = Fernet.generate_key()
print(key.decode())  # –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –≤ .env —Ñ–∞–π–ª
```

## üìÅ –•—Ä–∞–Ω–µ–Ω–∏–µ –∫–ª—é—á–∞

### –§–∞–π–ª .env
```
SECRET_KEY=–≤–∞—à_–∫–ª—é—á_–∑–¥–µ—Å—å
```

### –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ —Ñ–∞–π–ª–∞
- **–†–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏**: –í –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞
- **–£–ø–∞–∫–æ–≤–∞–Ω–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ**: `~/Library/Application Support/VPNServerManager/.env`

## ‚öôÔ∏è –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏

### –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
```python
from cryptography.fernet import Fernet
import os
from dotenv import load_dotenv

load_dotenv()
SECRET_KEY = os.environ.get('SECRET_KEY')
fernet = Fernet(SECRET_KEY.encode())
```

### –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
```python
def encrypt_data(data):
    return fernet.encrypt(data.encode()).decode()

# –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
encrypted_password = encrypt_data("mypassword123")
```

### –†–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö
```python
def decrypt_data(encrypted_data):
    try:
        return fernet.decrypt(encrypted_data.encode()).decode()
    except:
        return ""

# –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
password = decrypt_data(encrypted_password)
```

## üîÑ –°–º–µ–Ω–∞ –∫–ª—é—á–∞

### –ü—Ä–æ—Ü–µ—Å—Å —Å–º–µ–Ω—ã
1. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –Ω–æ–≤—ã–π –∫–ª—é—á
2. –°–æ–∑–¥–∞–µ—Ç—Å—è —Ä–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö
3. –í—Å–µ –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ—à–∏—Ñ—Ä–æ–≤—ã–≤–∞—é—Ç—Å—è –Ω–æ–≤—ã–º –∫–ª—é—á–æ–º
4. –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Ñ–∞–π–ª .env

### –ö–æ–¥ —Å–º–µ–Ω—ã –∫–ª—é—á–∞
```python
# –í —Ñ—É–Ω–∫—Ü–∏–∏ change_main_key()
old_key = os.environ.get('SECRET_KEY')
new_key = request.form.get('new_key')

# –û–±–Ω–æ–≤–ª—è–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
SECRET_KEY = new_key
fernet = Fernet(SECRET_KEY.encode())

# –ü–µ—Ä–µ—à–∏—Ñ—Ä–æ–≤—ã–≤–∞–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ
servers = load_servers()  # –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç–∞—Ä—ã–º–∏ –∫–ª—é—á–æ–º
save_servers(servers)     # –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–æ–≤—ã–º –∫–ª—é—á–æ–º
```

## üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ê–ª–≥–æ—Ä–∏—Ç–º —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è
- **Fernet** (AES-128 + HMAC-SHA256)
- **–°–∏–º–º–µ—Ç—Ä–∏—á–Ω–æ–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ**
- **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π**

### –ó–∞—â–∏—Ç–∞ –∫–ª—é—á–∞
- –ö–ª—é—á –ù–ï —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ Git
- –§–∞–π–ª .env –≤ .gitignore
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏ —Å–º–µ–Ω–µ

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

### –ü–æ—Ç–µ—Ä—è –∫–ª—é—á–∞
- **–ë–µ–∑ –∫–ª—é—á–∞ –¥–∞–Ω–Ω—ã–µ –ù–ï–í–û–ó–ú–û–ñ–ù–û –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å**
- –í—Å–µ–≥–¥–∞ –¥–µ–ª–∞–π—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ "–ü–æ–ª–Ω—ã–π —ç–∫—Å–ø–æ—Ä—Ç" –¥–ª—è backup

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–ª—é—á–∞
```python
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –∫–ª—é—á–∞ –∏ –¥–∞–Ω–Ω—ã—Ö
try:
    decrypted_data = fernet.decrypt(encrypted_data)
    return True
except InvalidToken:
    return False
```

## üìã –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –í app.py
```python
# –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª—è SSH
server['ssh_credentials']['password'] = encrypt_data(password)

# –†–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
decrypted_password = decrypt_data(server['ssh_credentials']['password'])
```

### –í —Ñ—É–Ω–∫—Ü–∏—è—Ö —ç–∫—Å–ø–æ—Ä—Ç–∞
```python
# –≠–∫—Å–ø–æ—Ä—Ç –∫–ª—é—á–∞
with open('exported_key.env', 'w') as f:
    f.write(f'SECRET_KEY={SECRET_KEY}')
```

## üîç –û—Ç–ª–∞–¥–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–ª—é—á–∞
```bash
python3 decrypt_tool.py
```

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –∫–ª—é—á–∞
```bash
python3 generate_key.py
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è
- –í –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- –§—É–Ω–∫—Ü–∏—è "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ"
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–µ—Ä–≤–µ—Ä–æ–≤ –≤ —Ñ–∞–π–ª–µ 